<?php

/**
 * @file
 * webform_encryption.module
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_entity_type_alter().
 */
function webform_encryption_entity_type_alter(&$entity_types) {
  $entity_types['webform_submission']->setStorageClass('Drupal\webform_encryption\WebformEncryptionSubmissionStorage');
}

/**
 * Implements hook_form_webform_ui_element_form_alter().
 */
function webform_encryption_form_webform_ui_element_form_alter(&$form, FormStateInterface $form_state) {

    $element_manager = \Drupal::service('plugin.manager.webform.element');
    $element = $form_state->getBuildInfo()['callback_object']->getElement();
    $element_handler = $element_manager->getElementInstance($element);

    if ($element_handler->isInput($element)) {

        // To provide the fieldset for encryption fields on element config form.
        $form['element_encrypt'] = [
            '#type' => 'details',
            '#title' => t('Encryption'),
        ];

        // To provide the encryption fields for webform elements.
        $form['element_encrypt']['encrypt'] = [
            '#type' => 'webform_element_encrypt',
            '#title' => t('Encryption'),
            '#title_display' => 'hidden',
        ];
    }
}
