<?php


/**
 * @file
 * Hook implementations for Layout Plugin module.
 */
use Drupal\Core\Menu\MenuActiveTrail; 
 
 
function fullmenu_preprocess_block(&$variables) {
  //drupal_set_message('fullmenu_preprocess_block:success');
  //$plugin_id = $variables['plugin_id'];
  //drupal_set_message('plugin_id:' . $plugin_id);
  $base_plugin_id = $variables['base_plugin_id'];
  if($base_plugin_id == 'system_menu_block' ){
    //$label =  $variables['label'];
	//drupal_set_message('label:'.var_export($label, true));
    //$base_plugin_id = $variables['base_plugin_id'];
    //$derivative_plugin_id = $variables['derivative_plugin_id'];
	 //drupal_set_message('base_plugin_id:' . $base_plugin_id);
	 //drupal_set_message('derivative_plugin_id:' . $derivative_plugin_id);
	 $menu_name = $variables['derivative_plugin_id'];
	 //$active_trail = MenuActiveTrail->getActiveTrailIds($menu_name);
	 $active_trail =  \Drupal::menuTree()->getCurrentRouteMenuTreeParameters($menu_name);
	 $expandedParents = $active_trail->expandedParents;
	 unset($expandedParents['']);
	 $parent_menu_link = array_pop($expandedParents);
	 $entity_uuid = substr($parent_menu_link,18);
	 $menu_link_content = \Drupal::entityManager()->loadEntityByUuid('menu_link_content', $entity_uuid);
	 //$menu_link_name = $menu_link_content->title->value;
	 //$variables['label'] = $menu_link_name;
	 $variables['configuration']['label'] =  $menu_link_content->title->value;
	 //drupal_set_message('123:'.var_export($menu_link_name, true));
  
  }
}