<?php

/**
 * @file
 * multi_step module file.
 */

use Drupal\Core\Form\ConfirmFormInterface;
use Drupal\Core\Entity\ContentEntityFormInterface;

/**
 * Implements hook_field_group_pre_render().
 */
function multistep_submit_field_group_pre_render(&$element, $group, &$form) {
  
  $prefix = '<h3>'.t($group->label).'</h3>';
  
  if ($group->format_type == 'multistep_submit') {
    $element += [
      '#type' => 'markup',
      '#prefix' => $prefix,
      '#weight' => $group->weight,
    ];
  }

}

/**
 * Implements hook_form_alter().
 */
function multistep_submit_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id){

  $form_object = $form_state->getFormObject();
  if ($form_object instanceof ContentEntityFormInterface && !$form_object instanceof ConfirmFormInterface && !in_array("administrator", \Drupal::currentUser()->getRoles())) {

    $storage = $form_state->getStorage();
    if (!empty($storage['form_display'])) {
      $form_display = $storage['form_display'];
      $entity = $form_object->getEntity();
      $entity_type = $entity->getEntityTypeId();
      $bundle = $entity->bundle();
      $mode = $form_display->getMode();
      //check if form has multistep submit fieldgroup
      $fieldgroups = field_group_info_groups($entity_type, $bundle, 'form', $mode);
      if(!empty($fieldgroups)){
        if(reset($fieldgroups)->format_type == 'multistep_submit'){
          //add specific class to form
          $form['#attributes']['class'][] = 'multistep-submit-form';
          $form['actions']['#attributes']['class'][] = 'visually-hidden';
          $form['actions']['submit']['#attributes']['class'][] = 'multistep-sbumit-btn';
        }
      }

    }
  }

}


