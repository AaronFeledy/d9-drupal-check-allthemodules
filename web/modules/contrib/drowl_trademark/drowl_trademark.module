<?php

function drowl_trademark_page_attachments(array &$page) {
  $module_path = drupal_get_path('module', 'drowl_trademark');
  // Don't include on admin pages. It also breaks the WYSIWYG!

  $route = \Drupal::routeMatch()->getRouteObject();
  $path_is_admin = \Drupal::service('router.admin_context')
    ->isAdminRoute($route);

  $current_path = \Drupal::service('path.current')->getPath();
  $matches_path = \Drupal::service('path.matcher')
    ->matchPath($current_path, '*/js');
  if (!$path_is_admin && !$matches_path) {
    $replacements = \Drupal::config('drowl_trademark.settings')
      ->get('drowl_trademark_replacements');
    if (!empty($replacements)) {
      // This all only makes sense if there are replacements set:
      $replacementsArray = \Drupal\Component\Utility\Tags::explode($replacements);
      $replacepattern = implode('|', $replacementsArray);
      if (!empty($replacepattern)) {
        $page['#attached']['library'][] = 'drowl_trademark/drowl_trademark';
        $page['#attached']['drupalSettings']['drowl_trademark']['replacepattern'] = $replacepattern;

        $filter = \Drupal::config('drowl_trademark.settings')
          ->get('drowl_trademark_filter');
        $page['#attached']['drupalSettings']['drowl_trademark']['filter'] = $filter;
      }
    }    
  }
}