<?php

/**
 * @file
 * Provides Content Namespace, <channel> and <item> elements
 * for Views RSS module.
 */

/**
 * Implements hook_views_rss_namespaces().
 */
function views_rss_content_views_rss_namespaces() {
  $namespaces['content'] = array(
    'prefix' => 'xmlns',
    'uri' => 'http://purl.org/rss/1.0/modules/content/',
  );
  return $namespaces;
}

/**
 * Implements hook_views_rss_item_elements().
 */
function views_rss_content_views_rss_item_elements() {
  $elements['content:encoded'] = array(
    'description' => t("The &lt;content:encoded&gt; element can be used in conjunction with the &lt;description&gt; element to provide an item's full content along with a shorter summary. Under this approach, the complete text of the item is presented in &lt;content:encoded&gt; and the summary in &lt;description&gt;."),
    'preprocess functions' => array(
      'views_rss_rewrite_relative_paths',
      'views_rss_content_preprocess_item_encoded',
    ),
    'help' => 'http://www.rssboard.org/rss-profile#namespace-elements-content-encoded',
  );
  return $elements;
}

/**
 * Preprocess function for item <source> element.
 */
function views_rss_content_preprocess_item_encoded(&$variables) {
  foreach ($variables['elements'] as $delta => $element) {
    if (!empty($element['value'])) {
      $variables['elements'][$delta]['value'] = '<![CDATA[' . $element['value'] . ']]>';
      $variables['elements'][$delta]['encoded'] = TRUE;
    }
  }
}
