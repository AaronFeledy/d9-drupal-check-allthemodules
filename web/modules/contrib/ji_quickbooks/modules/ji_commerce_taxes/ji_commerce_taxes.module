<?php

/**
 * @file
 * The ji_commerce_taxes.module file.
 */

use Drupal\Core\Link;
use Drupal\Core\Url;
use Drupal\Core\Messenger\MessengerInterface;

/**
 * Implements hook_form_alter().
 *
 * Disable the label field and display why we've disabled fields.
 */
function ji_commerce_taxes_form_alter(&$form, &$form_state, $form_id) {
  if ($form_id === 'commerce_tax_type_edit_form') {
    if ($form['plugin']['#default_value'] == 'quickbookstax') {
      $form['label']['#disabled'] = TRUE;
      // Let's allow them to disable a tax rate if needed.
      $form['status']['#disabled'] = FALSE;

      $route = Link::fromTextAndUrl(t('sync'), Url::fromRoute('ji_commerce_taxes.sync_taxes'))
        ->toString();
      \Drupal::messenger()
        ->addWarning(t("Editing a QuickBooks tax rate isn't allowed. Please do so within QuickBooks and then perform a @link", ['@link' => $route]), FALSE);
    }
  }

  // Remove QuickBooks Tax type from the select options.
  // We don't want users adding a tax amount. We encourage them to sync
  // a QBO tax rate instead.
  if ($form_id === 'commerce_tax_type_add_form') {
    if (isset($form['plugin']['#options']['quickbookstax'])) {
      unset($form['plugin']['#options']['quickbookstax']);
    }
  }
}
