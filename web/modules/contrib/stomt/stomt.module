<?php

/**
 * @file
 * A block module that displays the STOMT website plugin on the website.
 */

/**
 * Implements hook_page_attachments().
 *
 * Inserting JavaScript to the appropriate scope/region of every page.
 */
function stomt_page_attachments(array &$attachments) {
  $config = \Drupal::config('stomt.widget');

  $configuration = [
    'targetId' => $config->get('username'),
    'label' => $config->get('label'),
    'colorText' => $config->get('color_text'),
    'colorBackground' => $config->get('color_background'),
    'colorHover' => $config->get('color_hover'),
  ];

  $script = "
  (function(w, d, n, r, t, s){
    w.Stomt = w.Stomt||[];
    t = d.createElement(n);
    s = d.getElementsByTagName(n)[0];
    t.async=1;
    t.src=r;
    s.parentNode.insertBefore(t,s);
  })(window, document, 'script', 'https://www.stomt.com/widget.js');
  Stomt.push(['addTab', " . json_encode($configuration) . "]);
  ";

  $attachments['#attached']['html_head'][] = [
    [
      // The HTML tag to add.
      '#tag' => 'script',
      // The value of the HTML tag.
      '#value' => $script,
    ],
    // A key, to make it possible to recognize this HTML element.
    'stomt',
  ];
}
