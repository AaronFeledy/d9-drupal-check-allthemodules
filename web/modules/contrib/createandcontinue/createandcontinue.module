<?php

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Url;

/**
 * @file
 * Creates a button on node form that allows to create a node and continue to create another node of that type.
 */

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * @param array $form
 * @param $form_state
 */
function createandcontinue_form_node_form_alter(array &$form, FormStateInterface $form_state) {
  $current_path = \Drupal::service('path.current')->getPath();

  if (strpos($current_path, '/node/add/') !== FALSE) {
    $form_state->setValue('createandcontinue', $current_path);

    $form['actions']['createandcontinue'] = $form['actions']['submit'];
    $form['actions']['createandcontinue']['#value'] = t('Save and add another');
    $form['actions']['createandcontinue']['#submit'][] = 'createandcontinue_submit';
  }

}

/**
 * Submit callback to set the redirect.
 *
 * @param array $form
 * @param $form_state
 */
function createandcontinue_submit(array &$form, FormStateInterface $form_state) {
  $trigger = $form_state->getTriggeringElement();

  if (isset($trigger['#id']) && $trigger['#id'] == 'edit-createandcontinue') {
    $current_path = \Drupal::service('path.current')->getPath();
    $form_state->setRedirectUrl(Url::fromUserInput($current_path));
  }

}
