parameters:
  channel: adv_varnish

services:
  adv_varnish.event_subscriber:
    class: Drupal\adv_varnish\EventSubscriber\CacheableResponseSubscriber
    arguments: ['@adv_varnish.controller']
    tags:
      - {name: event_subscriber}

  cache_tags.invalidator.adv_varnish:
    class: Drupal\adv_varnish\Cache\AdvVarnishTagsInvalidator
    properties:
      varnishHandler: "@adv_varnish.handler"
    tags:
      - { name: cache_tags_invalidator}

  adv_varnish.configurator:
    class: Drupal\adv_varnish\VarnishConfigurator
    arguments: ['@config.factory', 'adv_varnish.settings']

  adv_varnish.handler:
    class: Drupal\adv_varnish\Varnish
    arguments: ['@current_user', '@adv_varnish.configurator']

  adv_varnish.controller:
    class: Drupal\adv_varnish\Controller\AdvVarnishController
    arguments: ['@adv_varnish.handler', '@adv_varnish.configurator', '@request_stack', '@module_handler', '@current_user']

  #adv_varnish.page_cache_request_policy.deny_page_cache:
  #  class: Drupal\adv_varnish\PageCache\DenyPageCache
  #  arguments: ['@current_route_match']
  #  tags:
  #    - { name: page_cache_response_policy }

  plugin.manager.varnish_cacheable_entity:
    class: Drupal\adv_varnish\VarnishCacheableEntityManager
    arguments: ['@container.namespaces', '@cache.default', '@module_handler']

  plugin.manager.user_block:
    class: Drupal\adv_varnish\UserBlockManager
    arguments: ['@container.namespaces', '@cache.default', '@module_handler']

  adv_varnish.logger:
    class: Drupal\Core\Logger\LoggerChannel
    factory_service: logger.factory
    factory_method: get
    arguments: ['%channel%']
    