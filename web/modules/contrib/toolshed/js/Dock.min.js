"use strict";var _createClass=function(){function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},_slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var o=[],i=!0,n=!1,s=void 0;try{for(var r,c=e[Symbol.iterator]();!(i=(r=c.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){n=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(n)throw s}}return o}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(t,l){l.Dock={createItem:function(e,t){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i={edge:"TOP",offset:0};if(!o||o.detectOpts)for(var n=null,s=/(?:^|\s)tsdock--(opt|edge)-([-\w]+)(?:\s|$)/g,r=e.attr("class");null!==(n=s.exec(r));)if("opt"===n[1])i[n[2]]=!0;else if("edge"===n[1]){var c=_slicedToArray(n,3);i.edge=c[2]}var a=new l.Dock.DockItem(e,t,_extends({},i,o));l.Dock.addDocker(i.edge.toUpperCase()||"TOP",a)},addDocker:function(e,t){l.Dock.containers[e]&&l.Dock.containers[e].addItem(t)}},l.Dock.DockContainer=function(){function e(){_classCallCheck(this,e),this.active=!1,this.container=null,this.items=[]}return _createClass(e,[{key:"isActive",value:function(){return this.active}},{key:"addItem",value:function(e){(e.dockTo=this).items.push(e),this.active||this.init()}},{key:"removeItem",value:function(t){this.items=this.items.filter(function(e){return e!==t}),delete t.dockTo,!this.items.length&&this.container&&this.container.hide()}},{key:"init",value:function(){this.container=t('<div class="tsdock-container"/>').appendTo(t("body")),this.initContainer(),this.active=!0,l.events.scroll.add(this),l.events.resize.add(this),this.onResize(new Event("resize"),l.winRect)}},{key:"onScroll",value:function(e,t,o){var i=this,n=new l.Geom.Rect(t);n.offset(o.left,o.top),this.items.forEach(function(e){if(e.isDocked^i.isDocking(e,n))return e.isDocked?e.deactivateDock():e.activateDock(i.container)},this)}},{key:"onResize",value:function(e,t){var o={top:document.documentElement.scrollTop||document.body.scrollTop,left:document.documentElement.scrollLeft||document.body.scrollLeft};t.top!==this.container.offset().top&&this.container.css({top:t.top}),this.onScroll(e,t,o)}},{key:"destroy",value:function(){l.events.scroll.remove(this),l.events.resize.remove(this),this.container&&this.container.remove()}}]),e}(),l.Dock.TopDockContainer=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,l.Dock.DockContainer),_createClass(t,[{key:"initContainer",value:function(){this.container.css({position:"fixed",top:0,width:"100%",boxSizing:"border-box"})}},{key:"isDocking",value:function(e,t){var o=e.getContainerRect(),i=Math.floor(e.placeholder.offset().top+e.config.offset);return e.config.offset<0&&(i+=e.placeholder.height()),i<t.top&&o.bottom>t.top&&e.elem.outerHeight()<o.getHeight()}}]),t}(),l.Dock.DockItem=function(){function i(e,t,o){_classCallCheck(this,i),this.elem=e,this.bounds=t,this.config=o,this.elem.addClass("tsdock-item"),this.isDocked=!1,this.config.animate&&(this.mode=this.config.animate.type||"slide"),this.init()}return _createClass(i,[{key:"init",value:function(){this.placeholder=this.elem.wrap('<div class="tsdock__placeholder"/>').parent(),this.placeholder.css({position:this.elem.css("position")}),this.height=this.elem.outerHeight(),this.config.trackMutations&&MutationObserver&&(this.observer=new MutationObserver(this._mutated.bind(this)),this.observer.observe(this.elem[0],{attributes:!0,childList:!0,subtree:!0,characterData:!0}))}},{key:"_mutations",value:function(){this.observer.disconnect();var e=this.elem.outerHeight();if(this.height!==e){this.height=e||0,this.placeholder&&this.placeholder.height(e);var t=new l.Geom.Rect(l.winRect),o=document.documentElement.scrollTop||document.body.scrollTop;this.scroll(o,t)}this.observer.observe(this.elem[0],{attributes:!0,childList:!0,subtree:!0,characterData:!0})}},{key:"getContainerRect",value:function(){var e=this.bounds.offset(),t=e.top,o=e.left;return new l.Geom.Rect(t,o,t+this.bounds.outerHeight(),o+this.bounds.outerWidth())}},{key:"activateDock",value:function(e){this.isDocked||(this.isDocked=!0,this.placeholder.height(this.height),e.append(this.elem),this.elem.addClass("tsdock-item--docked"),this.elem.trigger("ToolshedDocking.docked"))}},{key:"deactivateDock",value:function(){this.isDocked&&(this.isDocked=!1,this.placeholder.append(this.elem),this.elem.removeClass("tsdock-item--docked"),this.placeholder.css({height:""}),this.elem.trigger("ToolshedDocking.undocked"))}},{key:"destroy",value:function(){this.observer&&this.observer.disconnect(),this.deactivateDock(),this.placeholder&&this.elem.unwrap(".tsdock__placeholder")}}]),i}(),l.Dock.containers={TOP:new l.Dock.TopDockContainer}}(jQuery,Drupal.Toolshed);