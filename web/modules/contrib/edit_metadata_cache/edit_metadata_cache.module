<?php

/**
 * @file
 * Minimizes metadata HTTP requests triggered by Edit's JavaScript.
 */

/**
 * Implements hook_page_alter().
 *
 * Dynamically attaches edit_metadata_cache's override whenever Edit is loaded.
 */
function edit_metadata_cache_page_alter(&$page) {
  if (isset($page['#attached']['library']) && in_array(array('edit', 'edit'), $page['#attached']['library'])) {
    $page['#attached']['library'][] = array('edit_metadata_cache', 'edit_metadata_cache');
  }
}

/**
 * Implements hook_library_info().
 */
function edit_metadata_cache_library_info() {
  $path = drupal_get_path('module', 'edit_metadata_cache');
  $libraries['edit_metadata_cache'] = array(
    'title' => "Cache Edit's metadata in sessionStorage.",
    'version' => '',
    'js' => array(
      $path . '/js/edit_metadata_cache.js' => array('scope' => 'footer'),
    ),
    'dependencies' => array(
      array('edit', 'edit'),
    )
  );
  return $libraries;
}
