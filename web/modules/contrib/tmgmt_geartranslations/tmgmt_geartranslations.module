<?php

use Drupal\tmgmt\JobInterface;
use Drupal\tmgmt_geartranslations\Geartranslations\APIConnector;

/**
 * Implements hook_ENTITY_TYPE_delete().
 */
function tmgmt_geartranslations_tmgmt_job_delete(JobInterface $job) {
  // Notify operations if a job is deleted
  try {
    // Ignore jobs that don't have a smartling translator.
    if (!$job->hasTranslator() || $job->getTranslator()->getPluginId() != 'geartranslations') {
      return;
    }

    // Ignore inactive jobs
    if (!$job->isActive()) {
      return;
    }

    $translator = $job->getTranslator();
    $api = APIConnector::build($translator);
    $api->notifyJobDeletion($job);
  }
  catch (Exception $e) {
    \Drupal::logger('tmgmt_geartranslations')->error(
      'Job deletion failed with the following message: @message',
      ['@message' => $e->getMessage()]
    );
  }
}
