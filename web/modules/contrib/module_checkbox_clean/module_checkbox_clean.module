<?php


/*
 * Implements hook_form_FORM_ID_alter
 */
function module_checkbox_clean_form_system_modules_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
    $form['#attached']['library'][] = 'module_checkbox_clean/module_checkbox_clean_css';

    $html_class = 'module_checkbox_clean_checked';
    $html_text  = t('Enabled');
    $html_title = t('Unlike in Drupal 7, Drupal 8 does not allow disabling existing modules. Instead, they must be uninstalled by choosing the \'Uninstall\' tab above.');

    // Replace all checked checkboxes with an "enabled" label instead
    foreach ($form['modules'] as $group_id => $group) {
        foreach ($group as $mod_id => $module) {
            if (is_array($module) and isset($module['enable']) and ($module['enable']['#default_value'] == 1)) {
                $form['modules'][$group_id][$mod_id]['enable'] = array(
                  '#type' => 'item',
                  '#title' => t('Enabled'),
                  '#markup' => "<div class=\"$html_class\" title=\"$html_title\">$html_text</div>",
                );
            }
        }
    }
}

