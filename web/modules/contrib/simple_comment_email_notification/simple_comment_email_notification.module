<?php

use Drupal\comment\Entity\Comment;
use Drupal\Core\Entity\EntityInterface;

/**
 * Implements hook_mail().
 */
function simple_comment_email_notification_mail($key, &$message, $params) {
  switch ($key) {
   case 'new_comment':
     $message['from'] = \Drupal::config('system.site')->get('mail');
     $message['subject'] = t('New comment with subject "@subject" on @siteName', [
       '@subject'  => $params['subject'],
       '@siteName' => \Drupal::config('system.site')->get('name'),
     ]);
     $message['body'][] = t('You can check the page at :unapprovedCommentsUrl for unapproved comments and :publishedCommentsUrl for published comments.', [
       ':unapprovedCommentsUrl' => \Drupal::request()->getSchemeAndHttpHost() . '/admin/content/comment/approval',
       ':publishedCommentsUrl'  => \Drupal::request()->getSchemeAndHttpHost() . '/admin/content/comment',
     ]);
     break;
  }
}

/**
 * Implements hook_entity_insert().
 */
function simple_comment_email_notification_entity_insert(EntityInterface $entity) {
  if ($entity->getEntityTypeId() == 'comment') {
    /**
     * @var Comment $entity
     */
    $mailManager = \Drupal::service('plugin.manager.mail');
    $module = 'simple_comment_email_notification';
    $key = 'new_comment';
    $to = \Drupal::config('system.site')->get('mail');
    $langcode = \Drupal::currentUser()->getPreferredLangcode();
    $send = true;
    $mailManager->mail($module, $key, $to, $langcode, ['subject' => $entity->getSubject()], NULL, $send);

    \Drupal::logger('Simple Comment eMail Notification')->notice(t('Sent eMail notification for comment with subject "@subject" 
    to the site administrator eMail address :siteAdministratorEmailAddress', [
      '@subject'                       => $entity->getSubject(),
      ':siteAdministratorEmailAddress' => \Drupal::config('system.site')->get('mail')
    ]));
  }
}
