<?php

/**
 * @file
 * Module file for noindex.
 *
 * --------------------
 * EDITING INSTRUCTIONS
 * ---------------------
 * Change the numbers in the comma-separated list below.
 * The example "[3, 67, 100]" adds the meta tag to nodes 3, 67 and 100.
 * Please visit the project page for more detailed instructions.
 */

/**
 * Defines nodes not to be indexed.
 */
function noindex_specify_nodes() {
  return $noindex_nodes = [3, 67, 100];
}

/**
 * Implements hook_page_attachments().
 */
function noindex_page_attachments(array &$attachments) {
  $currentnode = \Drupal::routeMatch()->getParameter('node');
  if ($currentnode) {
    $currentnodeid = $currentnode->id();
    foreach (noindex_specify_nodes() as $node) {
      if ($currentnodeid == $node) {
        $newtag = [
          '#tag' => 'meta',
          '#attributes' => [
            'name' => 'robots',
            'content' => 'noindex',
          ],
        ];
        $attachments['#attached']['html_head'][] = [$newtag, 'robots'];
      }
    }
  }
}
