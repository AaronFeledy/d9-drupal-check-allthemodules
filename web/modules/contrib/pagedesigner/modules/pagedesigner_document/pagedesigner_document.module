<?php

/**
 * @file
 * Contains pagedesigner_document.module.
 */

use Drupal\Core\Routing\LocalRedirectResponse;
use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function pagedesigner_document_help($route_name, RouteMatchInterface $route_match)
{
    switch ($route_name) {
        // Main module help for the pagedesigner_document module.
        case 'help.page.pagedesigner_document':
            $output = '';
            $output .= '<h3>' . t('About') . '</h3>';
            $output .= '<p>' . t('Pagedesigner document extension') . '</p>';
            return $output;

        default:
    }
}

function pagedesigner_document_media_view($build, $entity, $display, $viewmode)
{
    if ($entity->bundle() == 'document') {
        if ($entity->field_media_file->entity != null && $viewmode == 'full') {
            $build['#cache'] = [
                'max-age' => 0,
            ];
            \Drupal::service('page_cache_kill_switch')->trigger();
            $response = new LocalRedirectResponse($entity->field_media_file->entity->url());
            $response->send();
            return $build;
        }
    }
}
