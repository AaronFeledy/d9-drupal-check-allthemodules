<?php

use Drupal\media\MediaInterface;
use GuzzleHttp\Exception\GuzzleException;

/**
 * Implements hook_ENTITY_TYPE_update().
 */
function cloudconvert_media_thumbnail_media_insert(MediaInterface $media) {
  /** @var \Drupal\cloudconvert_media_thumbnail\MediaThumbnailManager $mediaThumbnailManager */
  $mediaThumbnailManager = Drupal::service('cloudconvert_media_thumbnail.manager');
  try {
    $mediaThumbnailManager->queueThumbnailTask($media);
  }
  catch (\Exception $e) {
    return;
  }
  catch (GuzzleException $e) {
    return;
  }
}

/**
 * Implements hook_ENTITY_TYPE_update().
 */
function cloudconvert_media_thumbnail_media_update(MediaInterface $media) {
  /** @var \Drupal\cloudconvert_media_thumbnail\MediaThumbnailManager $mediaThumbnailManager */
  $mediaThumbnailManager = Drupal::service('cloudconvert_media_thumbnail.manager');
  if ($mediaThumbnailManager->mediaSourceHasChanged($media)) {
    try {
      $mediaThumbnailManager->queueThumbnailTask($media);
    }
    catch (\Exception $e) {
      return;
    }
    catch (GuzzleException $e) {
      return;
    }
  }
}
