<?php

/**
 * @file
 * Main module file.
 */

/**
 * Implements hook_form_alter().
 */
function suggest_similar_titles_form_alter(&$form, &$form_state, $form_id) {
  // Checking if user has access to view suggested titles.
  if (\Drupal::currentUser()->hasPermission('view similar titles suggestion')) {
    $types = \Drupal\node\Entity\NodeType::loadMultiple();
    foreach ($types as $index => $type) {
      if ($form_id ==  'node_' . $index . '_form') {
        if (\Drupal::state()->get($index . "_suggest_similar_titles") ?: "" ) {
          if ((\Drupal::state()->get("suggest_similar_titles_settings") ?: "top") == 'top') {
            $form['title']['#prefix'] = '<div id="ajax-title-div"><span class="type">' . $index . '</span>
              <span class="base_path">' . base_path() . '</span>
                <div id="ajax-title-container" class="' . (\Drupal::state()->get("suggest_similar_titles_settings") ?: "top") . '"> </div>';
            $form['title']['#suffix'] = '</div>';
          }
          else {
            $form['title']['#prefix'] = '<div id="ajax-title-div">';
            $form['title']['#suffix'] = '<span class="type">' . $index . '</span>
              <span class="base_path">' . base_path() . '</span>
                <div id="ajax-title-container" class="' . (\Drupal::state()->get("suggest_similar_titles_settings") ?: "top") . '"> </div>
              </div>';
          }
        }
      }
    }
  }
  return $form;
}

function suggest_similar_titles_page_attachments(array &$attachments) {
  if (!\Drupal::currentUser()->hasPermission('view similar titles suggestion')) {
    return;
  }
  $attachments['#attached']['library'][] = 'suggest_similar_titles/suggest-similar-titles';
}
 
/**
 * Implements hook_theme().
 */
function suggest_similar_titles_theme() {
  return array(
    'suggest_similar_titles' => array(
      'variables' => array('node' => NULL),
      'template' => 'title-suggestion',
    ),
  );
}
