<?php

/**
 * @file
 */

use Drupal\user\Entity\User;
use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function killadblock_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.killadblock':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Kill AdBlock detects adblocker plugins and inform user to disable it.') . '</p>';
      $output .= '<h3>' . t('Uses') . '</h3>';
      $output .= '<p>' . t('It detects if a user is using ad blocker plugin like Adblock plus, Adblock, uBlock Adblocker Plus on the following web browsers and display a banner to disable the ad block or white-list your website. so that you focus only on your core business and generate good Ad revenue.') . '</p>';
      return $output;
  }
}

/**
 * Implements hook_preprocess_page().
 */
function killadblock_preprocess_page(array &$page) {
  $config = \Drupal::config('killadblock.settings');
  $current_user = User::load(\Drupal::currentUser()->id());

  $checkRole = !empty(\array_intersect(
    \array_filter($config->get('roles')),
    $current_user->getRoles()
  ));
  if ($checkRole) {
    $page['#attached']['library'][] = 'killadblock/killadblock-script';
    $page['#attached']['library'][] = 'killadblock/killadblock-css';

    $kadb_title = $config->get('kadb_title');
    $kadb_description = $config->get('kadb_description')['value'];
    $kadb_btn_txt = $config->get('kadb_btn_txt');

    $page['#attached']['drupalSettings']['drupal_kadb_title'] = $kadb_title;
    $page['#attached']['drupalSettings']['drupal_kadb_description'] = $kadb_description;
    $page['#attached']['drupalSettings']['drupal_kadb_btn_txt'] = $kadb_btn_txt;
  }
}
