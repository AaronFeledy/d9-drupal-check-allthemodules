<?php

namespace Drupal\registry_codelists\Controller;

use \Drupal\Core\Form\FormStateInterface;

class CodelistsValidator {
  /*
   * check if code of code or codelist exists, it could be only a unique value.
   */  
  function validate(&$form, $form_state) {
    $codelistTitles = [];
    $title = strtolower($form_state->getValue('title')[0]['value']);
    
    $nids = \Drupal::entityQuery('node')
            ->condition('type','registry_codelists')
            ->execute();
    $nodes =  \Drupal\node\Entity\Node::loadMultiple($nids);
    
    foreach ($nodes as $node) {
      array_push($codelistTitles,strtolower($node->getTitle()));
    }
    $nids = \Drupal::entityQuery('node')
            ->condition('type','inspire_codelist')
            ->execute();
    $nodes =  \Drupal\node\Entity\Node::loadMultiple($nids);
    
    foreach ($nodes as $node) {
      array_push($codelistTitles,strtolower($node->getTitle()));
    }
   
    if (in_array($title,$codelistTitles)) {
      $form_state->setErrorByName('title', t('That code list exists.'));
    };
  }
}

