<?php
use Drupal\node\Entity\Node;

function registry_examples_proxies_install() {
  $ids = \Drupal::entityQuery('taxonomy_term')
    ->condition('vid', 'namespaces') 
    ->condition('field_namespace', 'ex')  // Once we have our conditions specified we use the execute() method to run the query
    ->execute();
  $namespace = null;
  foreach ($ids as $key => $value) {
    $namespace = $value;
  }
  
  //create redirects
  //
  $postRequest = '<?xml version="1.0" encoding="UTF-8"?>
<csw:GetCapabilities xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW">
<ows:AcceptVersions xmlns:ows="http://www.opengis.net/ows">
<ows:Version>2.0.2</ows:Version>
</ows:AcceptVersions>
<ows:AcceptFormats xmlns:ows="http://www.opengis.net/ows">
<ows:OutputFormat>application/xml</ows:OutputFormat>
</ows:AcceptFormats>
</csw:{OID}>';
  //POST (proxy)
  $nodePost = Node::create([
    'type' => 'redirect',
    'title' => 'BeispielPost',
    'field_post_typ' => 'application/xml',
    'field_post_anfragedaten' => $postRequest,
    'field_id_muster' => '/^[A-Z].*/',
    'field_post_anfrage' => 'ja',
    'field_url_vorlage_' => 'http://gdk.gdi-de.org/inspire/srv/eng/csw?',
  ]);
  $nodePost->save();
  
  //GET (real redirect)
  $nodeGet = Node::create([
    'type' => 'redirect',
    'title' => 'BeispielGet',
    'field_id_muster' => '/.*/',
    'field_post_anfrage' => 'nein',
    'field_url_vorlage_' => 'https://www.google.de/?q={OID}',
  ]);
  $nodeGet->save();
  
  //create "namespace" with proxy functions
  $nodeNamespace = Node::create([
    'type' => 'namensraum',
    'title' => 'Beispielnamensraum',
    'body' => 'es handelt sich hierbei lediglich um ein Beispiel zur Veranschaulichung der Funktionsweise',
    'field_namespace' => $namespace,
  ]);
  $nodeNamespace->field_id_resolver[] = $nodePost->id();
  $nodeNamespace->field_id_resolver[] = $nodeGet->id();
  $nodeNamespace->save();
}
  

function registry_examples_proxies_uninstall() {
   
}

