<?php

/**
 *
 * @file Inserts geolocation information into HTTP headers to these values can be used in other module, plugins, and themes.
 *
 * IP2Location is a non-intrusive geo IP solution to help you to identify
 * visitor's geographical location, i.e. country, region, city, latitude,
 * longitude, ZIP code, time zone, connection speed, ISP and domain name,
 * IDD country code, area code, weather station code and name, and mobile
 * carrier, elevation, usage type information using a proprietary IP
 * address lookup database and technology without invading the Internet
 * user's privacy.
 *
 * This module is using IP2Location database to lookup for visitor
 * location and insert the variables into HTTP headers. Other developers
 * can use these variables to customize their content based on visitor
 * location.
 * @author Hexasoft.    <https://www.drupal.org/u/hexasoft>
 */


/**
 * Get geolocation information from visitor IP address.
 *
 * @return stdClass|bool Geolocation object or false if geolocation was not found
 */
function ip2location_get_records() {
  $ip = \Drupal::request()->getClientIp();

  if (isset($_SERVER['DEV_MODE'])) {
    $ip = '8.8.8.8';
  }
  
  $session = \Drupal::service('session')->get('ip2location_' . $ip);

  if (is_null($json = json_decode($session)) == false) {
    return $json;
  }

  return false;
}