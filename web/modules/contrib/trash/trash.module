<?php

/**
 * @file
 * Contains trash.module.
 */

use Drupal\Core\Entity\EntityTypeInterface;
use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\trash\Plugin\Menu\DeleteTab;

/**
 * Implements hook_help().
 */
function trash_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the trash module.
    case 'help.page.trash':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('The Trash gives the ability to "undo" or "restore" the deletion of content entities. For more information, see the <a href=":trash">online documentation for the Trash module</a>.', [':trash' => 'https://www.drupal.org/documentation/modules/trash']) . '</p>';
      return $output;
  }
}

/**
 * Implements hook_local_tasks_alter().
 */
function trash_local_tasks_alter(&$local_tasks) {
  $entity_types = \Drupal::entityTypeManager()->getDefinitions();
  $moderated_entity_types =  array_filter($entity_types, function (EntityTypeInterface $entity_type) use ($entity_types) {
    return \Drupal::service('content_moderation.moderation_information')->canModerateEntitiesOfEntityType($entity_type);
  });

  foreach ($moderated_entity_types as $moderated_entity_type_id => $moderated_entity_type) {
    if (isset($local_tasks["entity.$moderated_entity_type_id.delete_form"])) {
      $local_tasks["entity.$moderated_entity_type_id.delete_form"]['class'] = DeleteTab::class;
      $local_tasks["entity.$moderated_entity_type_id.delete_form"]['entity_type_id'] = $moderated_entity_type_id;
    }
  }
}
