<?php

/**
 * @file
 * Core functions for the Better sub-themes module.
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Link;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function better_subthemes_form_block_admin_display_form_alter(&$form, FormStateInterface $form_state) {
  /** @var \Drupal\better_subthemes\BetterSubthemesManager $better_subthemes_manager */
  $better_subthemes_manager = \Drupal::service('better_subthemes.manager');

  // Get theme used by current Block layout form.
  $theme_name = \Drupal::routeMatch()->getParameter('theme');
  if (!isset($theme_name)) {
    $theme_name = \Drupal::config('system.theme')->get('default');
  }

  // Get the source theme if we are inheriting the block layout.
  /** @var \Drupal\Core\Theme\ActiveTheme $source_theme */
  $source_theme = $better_subthemes_manager->getSourceTheme('block layout', $theme_name);

  // Notify the end user if these theme is using block layout inheritance.
  if ($source_theme->getName() !== $theme_name) {
    drupal_set_message(t("This theme's Block layout is being inherited from the @theme theme, changes below will not be visible.", [
      '@theme' => Link::createFromRoute($source_theme->getExtension()->info['name'], 'block.admin_display_theme', ['theme' => $source_theme->getName()])->toString(),
    ]), 'warning');
  }
}
