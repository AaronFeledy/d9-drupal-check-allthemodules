<?php

/**
 * @file
 * Snowflakes module.
 */

/**
 * Check whether snowflakes are enabled.
 *
 * @return bool
 *   TRUE, if snowflakes are enabled on the page.
 */
function snowflakes_is_enabled() {
  return \Drupal::config('snowflakes.settings')->get('enabled');
}

/**
 * Check whether snowflakes should be displayed on the current page.
 *
 * @return bool
 *   TRUE, if snowflakes are enabled and should be displayed on the page.
 */
function snowflakes_should_display() {
  return snowflakes_is_enabled() &&
    (!\Drupal::config('snowflakes.settings')->get('exclude_admin') ||
      !Drupal::service('router.admin_context')->isAdminRoute());
}

/**
 * Implements hook_theme().
 */
function snowflakes_theme($existing, $type, $theme, $path) {
  return [
    'snowflakes' => [
      'variables' => [],
    ],
    'snowflakes_onoff' => [
      'variables' => [],
    ],
  ];
}

/**
 * Implements hook_page_bottom().
 */
function snowflakes_page_bottom(array &$page_bottom) {
  if (!snowflakes_should_display()) {
    // Early exit, if snowflakes should not be displayed.
    return;
  }
  $page_bottom['snowflakes'] = [
    '#theme' => 'snowflakes',
  ];
  if (\Drupal::config('snowflakes.settings')->get('toggle_button')) {
    $page_bottom['snowflakes_onoff'] = [
      '#theme' => 'snowflakes_onoff',
    ];
  }
}

/**
 * Implements hook_page_attachments().
 */
function snowflakes_page_attachments(array &$attachments) {
  if (!snowflakes_should_display()) {
    // Early exit, if snowflakes should not be displayed.
    return;
  }
  $attachments['#attached']['library'][] = 'snowflakes/snowflakes';
  if (\Drupal::config('snowflakes.settings')->get('toggle_button')) {
    $attachments['#attached']['library'][] = 'snowflakes/onoff';
  }
}
