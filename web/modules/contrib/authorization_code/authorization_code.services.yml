services:
  logger.channel.authorization_code:
    parent: logger.channel_base
    arguments: ['authorization_code']

  authorization_code.config:
    class: Drupal\Core\Config\ImmutableConfig
    factory: config.factory:get
    arguments: [authorization_code.settings]

  plugin.manager.user_identifier:
    class: Drupal\authorization_code\PluginManager
    parent: default_plugin_manager
    arguments: ['user_identifier', 'Plugin/UserIdentifier', '\Drupal\authorization_code\UserIdentifierInterface', '\Drupal\authorization_code\Annotation\UserIdentifier']

  plugin.manager.code_generator:
    class: Drupal\authorization_code\PluginManager
    parent: default_plugin_manager
    arguments: ['code_generator', 'Plugin/CodeGenerator', '\Drupal\authorization_code\CodeGeneratorInterface', '\Drupal\authorization_code\Annotation\CodeGenerator']

  plugin.manager.code_sender:
    class: Drupal\authorization_code\PluginManager
    parent: default_plugin_manager
    arguments: ['code_sender', 'Plugin/CodeSender', '\Drupal\authorization_code\CodeSenderInterface', '\Drupal\authorization_code\Annotation\CodeSender']

  authorization_code.code_repository:
    class: Drupal\authorization_code\CodeRepository
    arguments:
      - '@authorization_code.code_storage'
      - '@authorization_code.attempts_storage'
      - '@authorization_code.config'
      - '@password'

  authorization_code.code_storage:
    class: Drupal\Core\KeyValueStore\KeyValueStoreExpirableInterface
    factory: keyvalue.expirable:get
    arguments: ['authorization_code:codes']

  authorization_code.attempts_storage:
    class: Drupal\Core\KeyValueStore\KeyValueStoreExpirableInterface
    factory: keyvalue.expirable:get
    arguments: ['authorization_code:attempts']
