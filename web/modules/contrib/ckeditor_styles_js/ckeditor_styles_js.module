<?php

/**
 * @file
 * Contains ckeditor_styles_js.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function ckeditor_styles_js_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the ckeditor_styles_js module.
    case 'help.page.ckeditor_styles_js':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Define a CKEditor style set in your theme') . '</p>';
      return $output;

    default:
  }
}

/**
 * Modifies JavaScript settings that are added for text editors.
 *
 * @param array $settings
 *   All the settings that will be added to the page for the text formats to
 *   which a user has access.
 */
function ckeditor_styles_js_editor_js_settings_alter(array &$settings) {
  $theme = Drupal::config('system.theme')->get('default');
  $info = system_get_info('theme', $theme);

  if (!isset($info['ckeditor_styles_js'])) {
    return;
  }

  foreach ($settings['editor']['formats'] as $format => &$editor) {
    $editor['editorSettings']['stylesSet'] = $theme;
  }

}

function ckeditor_styles_js_library_info_alter(&$libraries, $extension) {
  if ($extension !== 'ckeditor') {
    return;
  }

  $theme = Drupal::config('system.theme')->get('default');
  $info = system_get_info('theme', $theme);

  if (!isset($info['ckeditor_styles_js'])) {
    return;
  }

  $styles = '/' . drupal_get_path('theme', $theme) . '/' . $info['ckeditor_styles_js'];
  $libraries['drupal.ckeditor']['js'][$styles] = [];
}
