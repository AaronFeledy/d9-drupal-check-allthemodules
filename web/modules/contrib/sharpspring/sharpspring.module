<?php
/**
 * @file
 * sharpspring.module
 */

use Drupal\sharpspring\SharpSpringClass;

/**
 * Implements hook_page_attachments().
 */
function sharpspring_page_attachments(array &$attachments) {

  $settings = Drupal::config('sharpspring.settings');
  $is_admin = Drupal::service('router.admin_context')->isAdminRoute();

  $id = $settings->get('sharpspring_account');
  $domain = $settings->get('sharpspring_domain');

  // 1. Check if the SS account number and domain have valid values.
  // 1a. Do not add JS to admin pages.
  // 2. Create and insert js.
  if (SharpSpringClass::validate_id($id) && SharpSpringClass::validate_domain($domain) && !$is_admin) {

    // Add javascript to handle Sharpspring callback.
    $attachments['#attached']['drupalSettings']['sharpspring'] = array(
      'domain' => $domain,
      'id' => $id,
    );
    $attachments['#attached']['library'][] = 'sharpspring/sharpspring';
  }

}
