<?php

/**
 * @file
 * A simple plugin that turns properly text area into auto expanding textarea.
 */

/**
 * Implements hook_libraries_info_file_paths().
 */
function expanding_textareas_libraries_info_file_paths() {
  return [drupal_get_path('module', 'expanding_textareas') . '/js/expanding.js'];
}

/**
 * Implements hook_element_info_alter().
 */
function expanding_textareas_element_info_alter(&$types) {
  $types['textarea']['#pre_render'][] = 'expanding_textareas_pre_render_text_format';
  $types['text_format']['#pre_render'][] = 'expanding_textareas_pre_render_text_format';
}

/**
 * Process a text format widget to load and attach expanding textareas format.
 */
function expanding_textareas_pre_render_text_format($element) {
  $field = &$element;
  $config = \Drupal::config('expanding_textareas.settings');
  if (($config->get('expanding_textareas_admin_fields') == '*') || (in_array($field['#id'], array_map('trim', explode("\n", $config->get('expanding_textareas_admin_fields')))))) {
    $element['#attributes']['class'][] = 'expanding';
    $element['#attached']['library'][] = 'expanding_textareas/expanding';
  }
  return $element;
}
