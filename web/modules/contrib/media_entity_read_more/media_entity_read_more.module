<?php

/**
 * @file
 * Contains media_entity_read_more.module.
 */

use Drupal\media_entity\Entity\MediaBundle;
use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Entity\Display\EntityViewDisplayInterface;

/**
 * Implements hook_entity_extra_field_info().
 */
function media_entity_read_more_entity_extra_field_info() {
  $extra = [];

  foreach (MediaBundle::loadMultiple() as $bundle) {
    $extra['media'][$bundle->Id()]['display']['media_entity_read_more'] = [
      'label' => t('Read more link'),
      'description' => t('Link to media entity'),
      'weight' => 500,
      'visible' => FALSE,
    ];
  }

  return $extra;
}

/**
 * Implements hook_ENTITY_TYPE_view().
 */
function media_entity_read_more_media_view(array &$build, EntityInterface $entity, EntityViewDisplayInterface $display, $view_mode) {
  if ($display->getComponent('media_entity_read_more')) {
    $media_entity_title_stripped = strip_tags($entity->label());
    $links['media_entity_read_more'] = [
      'title' => t('Read more<span class="visually-hidden"> about @title</span>', [
        '@title' => $media_entity_title_stripped,
      ]),
      'url' => $entity->urlInfo(),
      'language' => $entity->language(),
      'attributes' => [
        'rel' => 'tag',
        'title' => $media_entity_title_stripped,
      ],
    ];

    $build['media_entity_read_more'] = [
      '#theme' => 'links__media_entity__read_more',
      '#links' => $links,
      '#attributes' => ['class' => ['links', 'inline']],
    ];
  }
}
