<?php

/**
 * @file
 * Code for the entity counter module.
 */

/**
 * Implements hook_theme().
 */
function entity_counter_theme() {
  $info = [
    'entity_counter_source_settings_summary' => [
      'variables' => [
        'settings' => NULL,
        'source' => NULL,
      ],
      'template' => 'entity-counter-source-settings-summary',
    ],
    'entity_counter_wrapper' => [
      'render element' => 'element',
      'template' => 'entity-counter-wrapper',
    ],
    'entity_counter' => [
      'render element' => 'element',
      'template' => 'entity-counter',
    ],
  ];

  return $info;
}

/**
 * Implements hook_preprocess_HOOK() for 'entity_counter_wrapper'.
 */
function entity_counter_preprocess_entity_counter_wrapper(&$variables) {
  $element = &$variables['element'];

  $element += [
    '#wrapper_attributes' => [],
  ];
  $variables['attributes'] = $element['#wrapper_attributes'];
  $variables['tag'] = $element['#wrapper_tag'];

  // Assign an html ID.
  if (!isset($element['#attributes']['id'])) {
    $variables['attributes']['id'] = $element['#id'];
  }

  $variables['children'] = $element['#children'];
}

/**
 * Implements hook_preprocess_HOOK() for 'entity_counter'.
 */
function entity_counter_preprocess_entity_counter(&$variables) {
  $element = &$variables['element'];

  $variables['counter_value'] = $element['#counter_value'];
  $variables['entity_counter'] = $element['#entity_counter'];
  $variables['renderer_plugin'] = $element['#renderer_plugin'];
  $variables['renderer_settings'] = $element['#renderer_settings'];
}

/**
 * Implements hook_theme_suggestions_HOOK() for 'entity_counter'.
 */
function entity_counter_theme_suggestions_entity_counter(array $variables) {
  $suggestions = [];

  if (!empty($variables['element']['#renderer_plugin'])) {
    $suggestions[] = $variables['theme_hook_original'] . '__' . $variables['element']['#renderer_plugin'];
  }
  if (!empty($variables['element']['#entity_counter'])) {
    $suggestions[] = $variables['theme_hook_original'] . '__' . $variables['element']['#entity_counter'];
  }
  if (!empty($variables['element']['#renderer_plugin']) && !empty($variables['element']['#entity_counter'])) {
    $suggestions[] = $variables['theme_hook_original'] . '__' . $variables['element']['#renderer_plugin'] . '__' . $variables['element']['#entity_counter'];
  }

  return $suggestions;
}
