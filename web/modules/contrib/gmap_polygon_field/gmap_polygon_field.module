<?php

/**
 * @file
 * A Google Map field with polygon tools.
 */

use \Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_library_info_build().
 */
function gmap_polygon_field_library_info_build() {
  global $language;
  $config = \Drupal::config('gmap_polygon_field.settings');
  $language =  \Drupal::languageManager()->getCurrentLanguage()->getId();
  $libraries = array();

  $libraries['gmap'] = array(
  	'dependencies' => array(),
  	'js' => array(
  		'https://maps.googleapis.com/maps/api/js?v=3&language=' . $language . '&libraries=places%2Cvisualization%2Cgeometry&key=' . $config->get('gmap_polygon_field_api_key') => array('type' => 'external'),
  	),
  );

  return $libraries;
}

/**
 * Implements hook_help().
 */
function gmap_polygon_field_help($route_name, $route_match) {
  switch ($route_name) {
    case 'help.page.gmap_polygon_field':

      $filepath = dirname(__FILE__) . '/README.md';
      if (file_exists($filepath)) {
        $readme = file_get_contents($filepath);
      }
      else {
        $filepath = dirname(__FILE__) . '/README.txt';
        if (file_exists($filepath)) {
          $readme = file_get_contents($filepath);
        }
      }
      if (!isset($readme)) {
        return NULL;
      }

      return !empty($readme) ? '<pre>' . $readme . '</pre>' : NULL;
  }
}
