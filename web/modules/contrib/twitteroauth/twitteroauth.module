<?php

/**
 * @file
 * This module holds functions for twitteroauth.
 */

use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Entity\Display\EntityViewDisplayInterface;

/**
 * Implements hook_theme().
 */
function twitteroauth_theme() {
  return [
    'twitteroauth_content' => [
      'variables' => [
        'display_text' => NULL,
        'name' => NULL,
        'tweet_link' => NULL,
        'media_url' => NULL,
        'screen_name' => NULL,
        'created_at' => NULL,
        'result_index' => NULL,
      ],
    ],
  ];
}

/**
 * Implements hook_entity_view_alter().
 */
function twitteroauth_block_content_view_alter(array &$build, EntityInterface $entity, EntityViewDisplayInterface $display) {
  if ($entity->bundle() == 'twitteroauth_search') {
    $build['content']['tweet_content'] = [
      '#lazy_builder' => [
        'twitteroauth.tweet_fetcher:fetch',
        [
          $entity->field_twitteroauth_tweet_count->value,
          trim($entity->field_twitteroauth_search_query->value),
          $entity->field_twitteroauth_display_media->value,
          $entity->field_twitteroauth_expiration->value,
        ],
      ],
      '#create_placeholder' => FALSE,
    ];
  }
}
