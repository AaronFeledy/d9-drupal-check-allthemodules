<?php

/**
 * @file
 * Adds help text javascript to node forms.
 */

use Drupal\Core\Entity\ContentEntityInterface;
use Drupal\Core\Form\FormStateInterface;
use Drupal\node\NodeForm;

/**
 * Implements hook_form_alter().
 */
function help_text_form_alter(&$form, FormStateInterface $form_state, $form_id) {
	// Load form object.
	$form_object = $form_state->getFormObject();

	// Load module configuration
	$help_text_conf = \Drupal::config('help_text.settings');	

	// See if user want to add help text toggle on all pages.
	$node_form_only = $help_text_conf->get('node_form_only');
	if(!$node_form_only) {
		// Attach javascript to toggle help text display
		$form['#attached']['library'][] = 'help_text/help_text';

		// Pass module config to javascript
		$form['#attached']['drupalSettings']['help_text_toggle'] = [
		    'icon' => $help_text_conf->get('font_awesome_icon'),
		    'icon_size' => $help_text_conf->get('icon_size'),
		    'title' => $help_text_conf->get('icon_title_text'),
		    'alt' => $help_text_conf->get('icon_alt_text'),
	  	];
	}
	// Else only add help text toggle to node forms.
	else if($form_object instanceof NodeForm) {
		// Attach javascript to toggle help text display
		$form['#attached']['library'][] = 'help_text/help_text';

		// Pass module config to javascript
		$form['#attached']['drupalSettings']['help_text_toggle'] = [
		    'icon' => $help_text_conf->get('font_awesome_icon'),
		    'icon_size' => $help_text_conf->get('icon_size'),
		    'title' => $help_text_conf->get('icon_title_text'),
		    'alt' => $help_text_conf->get('icon_alt_text'),
	  	];
	}	

}

