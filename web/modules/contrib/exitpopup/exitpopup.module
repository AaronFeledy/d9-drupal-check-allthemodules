<?php

/**
 * @file
 * Exitpopup Module.
 */

use Drupal\user\Entity\User;

/**
 * Implements hook_preprocess_page().
 */
function exitpopup_preprocess_page(array &$page) {
  $config = \Drupal::config('exitpopup.settings');
  $current_user = User::load(\Drupal::currentUser()->id());
  $checkRole = !empty(array_intersect(array_filter($config->get('roles')), $current_user->getRoles()));
  if ($checkRole) {
    $page['#attached']['library'][] = 'exitpopup/exitpopup-script';
    $exitpopup_html = $config->get('exitpopup_html')['value'];
    $exitpopup_css = $config->get('exitpopup_css')['value'];
    $exitpopup_delay = $config->get('exitpopup_delay');
    $exitpopup_width = $config->get('exitpopup_width');
    $exitpopup_height = $config->get('exitpopup_height');
    $exitpopup_cookie_exp = $config->get('exitpopup_cookie_exp');
    // Binding the php variables to drupal settings.
    $page['#attached']['drupalSettings']['drupal_exitpopup_html'] = $exitpopup_html;
    $page['#attached']['drupalSettings']['drupal_exitpopup_css'] = $exitpopup_css;
    $page['#attached']['drupalSettings']['drupal_exitpopup_width'] = $exitpopup_width;
    $page['#attached']['drupalSettings']['drupal_exitpopup_height'] = $exitpopup_height;
    $page['#attached']['drupalSettings']['drupal_exitpopup_cookie_exp'] = $exitpopup_cookie_exp;
    $page['#attached']['drupalSettings']['drupal_exitpopup_delay'] = $exitpopup_delay;
  }
}
