<?php

/**
 * @file
 * JS Disclaimer for pop-up disclaimer message.
 *
 * The module allows to have a disclaimer message displayed to the
 * user on click of a link leading to any external website.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function js_disclaimer_help($route_name, RouteMatchInterface $route_match) {

  switch ($route_name) {
    case 'help.page.js_disclaimer':
      return t('<p><strong>JS Disclaimer</strong> allows to have a disclaimer dialogue message displayed to the user on click of a link leading to an external site. The disclaimer message is configurable from drupal administration section.</p>
        <p><strong>Features</strong>:</p>
        <ul>
          <li>By default displays a jsvascript confirm dialogue on click of external link.</li>
          <li>The default message displayed can be changed at <a href=":disclaimer-admin-link">JS Disclaimer settings</a>.</li>
          <li>To bypass the disclaimer dialogue add css class "not-external" to links.</li>
        </ul>
        ', [':disclaimer-admin-link' => '/admin/config/js-disclaimer']);
  }
}

/**
 * Implements hook_page_attachments_alter().
 */
function js_disclaimer_page_attachments_alter(array &$attachments) {

  $attachments['#attached']['library'][] = 'js_disclaimer/disclaimer.lib';
  $disclaimer_message = \Drupal::config('js_disclaimer.settings')->get('js_disclaimer.disclaimer_message');
  $attachments['#attached']['drupalSettings']['jsDisclaimer']['disclaimerMessage'] = (empty($disclaimer_message) ? t('You are navigating away from the website. Do you want to proceed?') : $disclaimer_message);
}
