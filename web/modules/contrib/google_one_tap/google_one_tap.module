<?php

/**
 * Implements hook_page_attachments().
 */
function google_one_tap_page_attachments(array &$attachments) {

  // Display only for anonymous users.
  if (!\Drupal::currentUser()->isAnonymous()) {
    return;
  }

  // Display only on front page and login page.
  if (!\Drupal::service('path.matcher')->isFrontPage() && !in_array(\Drupal::routeMatch()->getRouteName(), ['user.login', 'user.register'])) {
    return;
  }

  // Add attachments.
  $attachments['#attached']['library'][] = 'google_one_tap/one_tap';
  $attachments['#attached']['drupalSettings']['google_one_tap'] = [
    // Currently only Google Accounts are supported.
    "supportedAuthMethods" => [
      "https://accounts.google.com"
    ],
    "supportedIdTokenProviders" => [
      [
        "uri" => "https://accounts.google.com",
        "clientId" => Drupal::config('google_one_tap.configuration')->get('client_id'),
      ]
    ],
  ];
}
