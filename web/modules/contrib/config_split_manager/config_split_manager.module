<?php

/**
 * @file
 * Contains config_split_manager.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function config_split_manager_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the config_split_manager module.
    case 'help.page.config_split_manager':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Allows administrator to select modules per ennvironment and those will get exported to separate directories when exporting..') . '</p>';
      return $output;

    default:
  }
}

function config_split_manager_modules_installed($modules) {
  $devConfigObject = \Drupal::entityTypeManager()->getStorage('config_split')->load('dev');

  if ($devConfigObject) {
    $config = \Drupal::configFactory()->getEditable('config_split.config_split.dev');
    $modulesDiff = array_merge(array_flip($modules), $config->get('module'));

    $config->set('module', array_fill_keys(array_keys($modulesDiff), 0));
    $config->save(TRUE);
    drupal_set_message('Modules also added in "Dev Split".');
  }
}

function config_split_manager_modules_uninstalled($modules) {
  $devConfigObject = \Drupal::entityTypeManager()->getStorage('config_split')->load('dev');

  if ($devConfigObject) {
    $uninstalledModules = array_fill_keys($modules, 0);
    $config = \Drupal::configFactory()->getEditable('config_split.config_split.dev');
    $modulesDiff = array_diff_key($config->get('module'), $uninstalledModules);

    $config->set('module', $modulesDiff);
    $config->save(TRUE);
    drupal_set_message('Modules also removed from "Dev Split".');
  }
}
