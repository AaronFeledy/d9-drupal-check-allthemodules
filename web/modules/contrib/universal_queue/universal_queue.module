<?php

/**
 * @file
 * Core module functions for the universal_queue module.
 */

use Drupal\Core\Queue\QueueFactory;
use Drupal\Core\Queue\QueueInterface;

// Machine name of the queue.
define('UNIVERSAL_QUEUE_NAME', 'universal_queue');

/**
 * Implements hook_help().
 */
function universal_queue_help($route_name, \Drupal\Core\Routing\RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.universal_queue':
      $path = dirname(__FILE__) . '/README.txt';

      if (file_exists($path)) {
        $readme = file_get_contents($path);
      }
      if (!isset($readme)) {
        return NULL;
      }

      $output = '<pre>' . $readme . '</pre>';

      return $output;
  }

  return '';
}

/**
 * Add item to universal queue.
 *
 * @param string $callback
 *   Callback to be added to universal queue as item.
 * @param array $params
 *   Array of $callback params.
 * @param string $file
 *   File to be included before $callback will be called.
 *
 * @return bool
 *   Result of item creation.
 */
function universal_queue_add_item($callback, $params = array(), $file = '') {
  /** @var QueueFactory $queue_factory */
  $queue_factory = \Drupal::service('queue');
  /** @var QueueInterface $queue */
  $queue = $queue_factory->get(UNIVERSAL_QUEUE_NAME);

  return $queue->createItem(array(
    'callback' => $callback,
    'params' => $params,
    'file' => $file,
  ));
}
