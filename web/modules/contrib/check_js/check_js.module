<?php

use Drupal\check_js\Form\CheckJsConfigurationForm;


/**
 * Implements hook_page_attachments().
 */
function check_js_page_attachments(array &$attachments) {
  // Add css.
  $attachments['#attached']['library'][] = 'check_js/check_js';
}

/**
 * Implements hook_page_top().
 */
function check_js_page_top(array &$page_top) {
  // Get message value from config.
  $config = Drupal::configFactory()->getEditable('check_js.settings');
  $check_js_config = $config->get('check_js_message');
  
  $defaultConfig = CheckJsConfigurationForm::check_js_default_message();
  // Set default message value.
  $check_js_content = isset($check_js_config['value']) ? $check_js_config['value'] : $defaultConfig;
  // Set default message format.
  $check_js_format = isset($check_js_config['format']) ? $check_js_config['format'] : 'basic_html';
  
  
  // Get the message to display if javascript is disabled in browser.
  $check_js_formatted_text = check_markup($check_js_content, $check_js_format);
  // Set <noscript> tag which will display if javascript is disabled in browser.
  $page_top['check_js'] = array(
    '#type' => 'html_tag',
    '#tag' => 'p',
    '#noscript' => TRUE,
    '#value' => $check_js_formatted_text,
  );
}
