<?php

/**
 * @file
 * Shell - Web-based emulated shell access for your Drupal server.
 */

/**
 * Implements hook_theme().
 */
function shell_theme() {
  return [
    'page__shell__popup' => [
      'base hook' => 'page',
    ],
  ];
}

/**
 * Implements hook_page_top().
 */
function shell_page_top(array &$page_top) {
  // Always add JS to open the popup shell when link clicked.
  $page_top['#attached']['library'][] = 'shell/shell.popup_link';
  if (isset($page_top['toolbar'])) {
    // Remove the toolbar from the popup shell to gain viewport space.
    if (\Drupal::routeMatch()->getRouteName() === 'shell.popup') {
      $page_top['toolbar']['#access'] = FALSE;
    }
  }
}

/**
 * Implements hook_module_implements_alter().
 */
function shell_module_implements_alter(&$implementations, $hook) {
  // Shift order of 'hook_page_top' implementations to have shell module hook
  // fire after core.
  if ($hook == 'page_top') {
    $group = $implementations['shell'];
    unset($implementations['shell']);
    $implementations['shell'] = $group;
  }
}
