<?php

/**
 * @file
 * Provide examples of using the TCPDF module.
 */

/**
 * Implements hook_theme().
 */
function pdf_download_theme($existing, $type, $theme, $path) {
  return [
    'pdf_content' => [
        'variables' => ['pdf' => array() ] ,
        'template' => 'pdf',
    ],
  ];
}


function pdf_download_default_header(&$tcpdf, $context) {  global $base_url;

  // $args contains passed variable...
  $default_theme = \Drupal::config('system.theme')->get('default');
  if ($default_theme) {
    $theme_settings = \Drupal::config($default_theme . '.settings')->get();
    if (isset($theme_settings['logo']['path']) && (file_exists($theme_settings['logo']['path']))) {
      $tcpdf->Image(\Drupal::service('file_system')->realpath($theme_settings['logo']['path']), 10, 10, 30, 30, '', $base_url, '', TRUE, 150, '', FALSE, FALSE, 0, FALSE, FALSE, FALSE);
    }
    $tcpdf->Write(0, $context['welcome_message'], '', 0, 'L', TRUE, 0, FALSE, TRUE, 0);
  }
}
function tcpdf_get_instance($params = array(), $class = array(), $config = array()) {
  $default_params =[
    'orientation' => 'P',
    'unit' => 'mm',
    'format' => 'A4',
    'unicode' => TRUE,
    'encoding' => 'UTF-8',
    'diskcache' => FALSE,
    'pdfa' => FALSE,
  ];

  $params = array_merge($default_params, $params);

  if (!isset($class['class'])) {
    $class = [
      'class' => 'Drupal\pdf_download\TCPDFDrupal',
    ];
  }

    if (!isset($config['filename'])) {
    $config = [
      'filetype' => 'inc',
      'filename' =>  'tcpdf.config',
      'module' => 'tcpdf_example',
    ];
  }

  if (!defined('K_TCPDF_EXTERNAL_CONFIG')) {
    define('K_TCPDF_EXTERNAL_CONFIG', TRUE);
  }

  module_load_include($config['filetype'], $config['module'], $config['filename']);
  return new $class['class']($params['orientation'], $params['unit'], $params['format'], $params['unicode'], $params['encoding'], $params['diskcache'], $params['pdfa']);
}
