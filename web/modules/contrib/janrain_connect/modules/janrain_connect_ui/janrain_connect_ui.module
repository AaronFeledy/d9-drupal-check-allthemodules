<?php

/**
 * @file
 * Main file for the Janrain Connect UI.
 */

use Drupal\Core\Form\FormStateInterface;
use Symfony\Component\HttpFoundation\RedirectResponse;
use Drupal\Core\Url;

/**
 * Implements hook form_alter().
 */
function janrain_connect_ui_form_janrain_connect_form_changepasswordformnoauth_alter(&$form, FormStateInterface $form_state, $form_id) {

  $store = \Drupal::service('tempstore.private')->get('janrain_connect_ui_forgot_password_redirect_success');

  $result = $store->get('result');

  $access_token = !empty($result['access_token']) ? $result['access_token'] : NULL;

  if (empty($access_token)) {
    $url = Url::fromRoute('system.403');
    $response = new RedirectResponse($url->toString());
    $response->send();
    exit;
  }
}
