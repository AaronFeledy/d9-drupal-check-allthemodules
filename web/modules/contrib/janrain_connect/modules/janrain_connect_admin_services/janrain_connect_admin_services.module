<?php

/**
 * @file
 * Default file for the project.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook form_alter().
 */
function janrain_connect_admin_services_form_janrain_connect_ui_config_user_journey_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  $config = \Drupal::config('janrain_connect_admin_services.settings');

  $form['config_delete_account'] = [
    '#type' => 'details',
    '#title' => t('Account Delete Config'),
    '#open' => TRUE,
  ];

  $form['config_delete_account']['config_delete_account_redirects'] = [
    '#type' => 'details',
    '#title' => t('Redirects'),
    '#open' => TRUE,
  ];

  $form['config_delete_account']['config_delete_account_redirects']['config_delete_account_redirect_success'] = [
    '#type' => 'textfield',
    '#title' => t('Account delete success path'),
    '#description' => t('If not configured, front will be default page'),
    '#default_value' => $config
      ->get('config_delete_account_redirect_success'),
  ];

  $form['config_delete_account']['config_delete_account_redirects']['config_delete_account_redirect_fail'] = [
    '#type' => 'textfield',
    '#title' => t('Account delete fail path'),
    '#description' => t('If not configured, front will be default page'),
    '#default_value' => $config
      ->get('config_delete_account_redirect_fail'),
  ];

  $form['config_delete_account']['config_delete_account_redirects']['config_delete_account_redirect_disable_message'] = [
    '#type' => 'checkbox',
    '#title' => t('Disable message on redirect'),
    '#description' => t('Either in success or fail a message is showing as feedback, check to disable'),
    '#default_value' => $config
      ->get('config_delete_account_redirect_disable_message'),
  ];

  $form['#submit'][] = 'janrain_connect_admin_services_form_janrain_connect_ui_config_user_journey_form_submit';
}

/**
 * Form submission handler for janrain_connect_ui_config_user_journey_form().
 *
 * @see janrain_connect_admin_services_form_janrain_connect_ui_config_user_journey_alter()
 */
function janrain_connect_admin_services_form_janrain_connect_ui_config_user_journey_form_submit($form, FormStateInterface $form_state) {
  \Drupal::configFactory()->getEditable('janrain_connect_admin_services.settings')
    ->set(
      'config_delete_account_redirect_success',
      $form_state->getValue('config_delete_account_redirect_success')
    )
    ->set(
      'config_delete_account_redirect_fail',
      $form_state->getValue('config_delete_account_redirect_fail')
    )
    ->set(
      'config_delete_account_redirect_disable_message',
      $form_state->getValue('config_delete_account_redirect_disable_message')
    )
    ->save();
}
