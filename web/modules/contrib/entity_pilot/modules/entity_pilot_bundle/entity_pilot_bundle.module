<?php

/**
 * @file
 * Contains main module functions.
 */

use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Url;

/**
 * Implements hook_entity_operation().
 */
function entity_pilot_bundle_entity_operation(EntityInterface $entity) {
  $operations = [];
  $info = $entity->getEntityType();
  if (($bundle_of = $info->getBundleOf()) && ($entity_types = \Drupal::config('entity_pilot_bundle.settings')->get('entity_types')) &&
    in_array($bundle_of, $entity_types, TRUE) && \Drupal::currentUser()->hasPermission('administer entity_pilot departures')) {
    $operations['ep-bundle'] = [
      'title' => t('Send @name entities to Entity Pilot', [
        '@name' => \Drupal::entityTypeManager()->getDefinition($bundle_of)->getLabel(),
      ]),
      'weight' => 50,
      'url' => Url::fromRoute('entity_pilot_bundle.create_departure', [
        'entity_type' => $entity->getEntityTypeId(),
        'entity_id' => $entity->id(),
      ]),
    ];
  }
  return $operations;
}
