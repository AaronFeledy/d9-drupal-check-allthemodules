<?php

/**
 * @file
 * Contains dblog_quick_filter.module..
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Link;
use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Url;

/**
 * Implements hook_help().
 */
function dblog_quick_filter_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the dblog_quick_filter module.
    case 'help.page.dblog_quick_filter':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('A Quick filter for dblog messages') . '</p>';
      return $output;

    default:
  }
}

function dblog_quick_filter_get_logged_users() {
  $types = array();
  
  $connection = Drupal::database();

  $result = $connection->query('SELECT DISTINCT(watchdog.uid),users_field_data.name FROM {watchdog}
       INNER JOIN {users} ON watchdog.uid = users.uid   && watchdog.uid >0
       INNER JOIN {users_field_data} ON watchdog.uid = users_field_data.uid
       ORDER BY watchdog.uid');
  foreach ($result as $object) {
    $types[$object->name] = t($object->name);
  }

  return $types;
}

function dblog_quick_filter_theme() {
  // We use a template file to allow for translation of blocks of content.
  // Therefore we need to add this content at the theming layer.
  return [
    'dblog_filter_table' => [
      'template' => 'dblog_filter_table',
      'variables' => [],
    ],
  ];
}

/**
 * Implementing hook_menu_local_tasks_alter()
 * @param type $data
 * @param type $route_name
 */
function dblog_quick_filter_menu_local_tasks_alter(&$data, $route_name) {
     
    if($route_name == "dblog.overview") {
        $cddata['tabs'][0]['dblog_quick_filter.tabs'] = [
        '#theme' => 'menu_local_task',
        '#link' => [
          'title' => t('Quick Search Page'),
          'url' => Url::fromRoute('dblog_quick_filter.report_admin'),
          'localized_options' => [
            'attributes' => [
              'title' => t('Quick Search Page'),
            ],
          ],
        ],
      ];
}
}