<?php

use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Config\Entity\ConfigEntityInterface;
use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_help().
 */
function entity_collector_notify_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the entity_collector_notify module.
    case 'help.page.entity_collector_notify':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Sends an email to a participant when he/she is added to a collection. The email includes information about who added the participant and to what collection he or she is added.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function entity_collector_notify_form_entity_collection_type_edit_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  /** @var \Drupal\entity_collector\Entity\EntityCollectionTypeInterface $entityCollectionType */
  $entityCollectionType = $form_state->getFormObject()->getEntity();

  $form['entity_collector_notify_participant_notification'] = [
    '#type' => 'checkbox',
    '#title' => t('Notify new participants'),
    '#description' => t('When adding new participants to share a collection with, send a notification through the Message API.'),
    '#default_value' => $entityCollectionType->getThirdPartySetting('entity_collector_notify', 'participant_notification', FALSE),
  ];

  $form['#entity_builders'][] = 'entity_collector_notify_form_builder';

}

/**
 * Entity form builder to add the entity collector notify settings to the collection type.
 *
 * @param string $entity_type
 * @param \Drupal\Core\Config\Entity\ConfigEntityInterface $bundle
 * @param array $form
 * @param \Drupal\Core\Form\FormStateInterface $form_state
 */
function entity_collector_notify_form_builder($entity_type, ConfigEntityInterface $bundle, &$form, FormStateInterface $form_state) {
  $bundle->setThirdPartySetting('entity_collector_notify', 'participant_notification', $form_state->getValue('entity_collector_notify_participant_notification', FALSE));
}
