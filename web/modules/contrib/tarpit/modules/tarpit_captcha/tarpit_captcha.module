<?php

/**
 * Implements hook_captcha().
 */
function tarpit_captcha_captcha($op, $captcha_type = '') {
  switch ($op) {
    case 'list':
      return ['Tarpit'];

    case 'generate':
      if ($captcha_type == 'Tarpit') {
        $markup = \Drupal\tarpit\Event\InsideEvent::generateRandomTextAndLinks('/tarpit');

        $captcha = array();
        $captcha['solution'] = '';
        $captcha['form']['captcha_response'] = array(
          '#type' => 'item',
          '#markup' => $markup,
          '#attached' => ['library' => ['tarpit_captcha/tarpit_captcha']]
        );

        return $captcha;
      }
      break;
  }
}
