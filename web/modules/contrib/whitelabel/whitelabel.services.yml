services:
  whitelabel.whitelabel_session:
    class: Drupal\whitelabel\WhiteLabelSession
    arguments: ['@session']

  whitelabel.whitelabel_provider:
    class: Drupal\whitelabel\WhiteLabelProvider
    arguments: ['@entity_type.manager', '@whitelabel.whitelabel_session']

  whitelabel.path_processor:
    class: Drupal\whitelabel\PathProcessor\WhiteLabelPathProcessor
    arguments: ['@whitelabel.whitelabel_provider', '@config.factory', '@entity_type.manager', '@current_user']
    # Make sure we act last on outbound request, and first on inbound requests.
    tags:
      - { name: path_processor_inbound, priority: 500 }
      - { name: path_processor_outbound, priority: -500 }

  whitelabel.config_cache_invalidator:
    class: Drupal\whitelabel\EventSubscriber\WhiteLabelCacheConfigInvalidator
    arguments: ['@cache_tags.invalidator']
    tags:
      - { name: event_subscriber }

  cache_context.whitelabel:
    class: Drupal\whitelabel\Cache\Context\WhiteLabelCacheContext
    arguments: [ '@whitelabel.whitelabel_provider']
    tags:
      - { name: cache.context }

  theme.negotiator.whitelabel:
    class: Drupal\whitelabel\Theme\WhiteLabelNegotiator
    arguments: ['@whitelabel.whitelabel_provider', '@config.factory']
    tags:
      - { name: theme_negotiator, priority: 9999 }

  whitelabel.overrider:
    class: Drupal\whitelabel\WhiteLabelConfigOverride
    # Results in an endless loop.
    #arguments: ['@whitelabel.whitelabel_provider']
    tags:
      - { name: config.factory.override, priority: 9999 }

  whitelabel.whitelabel_context:
    class: Drupal\whitelabel\ContextProvider\CurrentWhiteLabelContext
    arguments: ['@whitelabel.whitelabel_provider']
    tags:
      - { name: 'context_provider' }

  whitelabel.whitelabel_store_resolver:
    class: Drupal\whitelabel\Resolver\WhiteLabelStoreResolver
    arguments: ['@whitelabel.whitelabel_provider', '@config.factory', '@entity_type.manager']
    tags:
      - { name: commerce_store.store_resolver, priority: 100 }
