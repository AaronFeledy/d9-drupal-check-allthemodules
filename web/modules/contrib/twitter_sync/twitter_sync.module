<?php

/**
 * @file
 * Provides functionality to display latest tweets.
 */

/**
 * Implements hook_theme().
 */
function twitter_sync_theme() {
  return [
    'tweets' => [
      'template' => 'tweets',
      'variables' => [
        'screen_name' => NULL,
        'tweets_ids'  => [],
      ],
    ],
  ];
}

/**
 * Implements hook_cron().
 */
function twitter_sync_cron() {
  $queue = \Drupal::queue('cron_twitter_consumer');
  $queue->createItem(NULL);
}

/**
 * Implements hook_help().
 */
function twitter_sync_help($route_name) {
  switch ($route_name) {
    case 'help.page.twitter_sync':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('The Twitter Sync module allows you to render latests tweets from a account as a block.') . '</p>';
      $output .= '<h3>' . t('Getting Started') . '</h3>';
      $output .= '<h4>' . t('1. Twitter Keys') . '</h4>';
      $output .= '<p>' . t('The first step is to create API keys and tokens in Twitter Developers portal. <a href=":twitter_keys" target="_blank">This video</a> shows the step-by-step process.', [':twitter_keys' => 'https://www.youtube.com/watch?v=3dsvNw5AiLc']) . '</p>';
      $output .= '<h4>' . t('2. Configure module') . '</h4>';
      $output .= '<p>' . t('With your consumer keys and tokens created, go to <a href=":config_form">/admin/config/system/twitter_sync</a> and input your Consumer keys, Consumer secret, Access Token and Access Token Secret into their respective fields.', [':config_form' => '/admin/config/system/twitter_sync']) . '</p>';
      $output .= '<p>' . t('Your Screen Name should be the Twitter account (<em>without the @</em>) you want to have the tweets showing up on the site.') . '</p>';
      $output .= '<h4>' . t('3. Enable block') . '</h4>';
      $output .= '<p>' . t('Twitter Sync will create a block to display the tweets. Go to <a href=":config_block">/admin/structure/block</a> and Place <strong>"Twitter Sync block"</strong> in the desired region. For more details on how to place and configure a block, visit <a href=":drupal_docs" target="_blank">Drupal docs</a>.', [
        ':drupal_docs' => 'https://www.drupal.org/docs/8/core/modules/block/overview',
        ':config_block' => '/admin/structure/block',
      ]) . '</p>';
      $output .= '<h4>' . t('4. Enable block') . '</h4>';
      $output .= '<p>' . t('Last step is to run cron.php. During cron, Twitter Sync will check the account tweeets and pull the latest ones.') . '</p>';

      return $output;
  }

  return NULL;
}
