<?php

/**
 * @file
 * Hook functions for Loading Animation module.
 */

/**
 * Implements hook_page_attachments().
 */
function loading_animation_page_attachments(&$attachments) {
  $js_settings = _loading_animation_get_settings();
  $request = \Drupal::request();
  if (!\Drupal::service('path.matcher')->matchPath($request->getPathInfo(), trim($js_settings['loading_animation_path_match_exclude']))) {
    $attachments['#attached']['drupalSettings']['loading_animation'] = $js_settings;
    $attachments['#attached']['library'][] = 'loading_animation/loader';
    $attachments['#attached']['library'][] = 'loading_animation/jquery';
  }
}

/**
 * Implements hook_help().
 */
function loading_animation_help($route_name) {
  switch ($route_name) {
    // Main module help for the block module
    case 'help.page.loading_animation':
    case 'loading_animation.settings':
      return '<p>' . t('Loading animation module shows a loading layer on page loading events. These may be triggered by form submission or clicking a hyperlink. Hyperlinks may be excluded from trigger by adding a ".noLoadingAnimation" class. Further "javascript" and "#" hyperlinks are excluded.') . '</p>';
  }
}

/**
 * Specifies the loading animation settings.
 *
 * @return array
 *   Array of configuration variables to be made available in JavaScript.
 */
function _loading_animation_get_settings() {
  return [
    'show_on_href' => \Drupal::config('loading_animation.settings')->get('show_on_href'),
    'show_on_form_submit' => \Drupal::config('loading_animation.settings')->get('show_on_form_submit'),
    'close_on_click' => \Drupal::config('loading_animation.settings')->get('close_on_click'),
    'close_on_esc' => \Drupal::config('loading_animation.settings')->get('close_on_esc'),
    'loading_animation_path_match_exclude' => \Drupal::config('loading_animation.settings')->get('path_match_exclude'),
    'subselector' => \Drupal::config('loading_animation.settings')->get('subselector'),
  ];
}
