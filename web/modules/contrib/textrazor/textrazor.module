<?php

/**
 * @file
 * The textrazor module.
 */

function textrazor_form_alter(&$form, $formstate, $form_id) {
  $textrazorManager = \Drupal::service('textrazormanager');
  if ($textrazorManager->hasTextrazorEnabled($form_id)) {
    $textrazorManager->prepareForm($form);
  }
}

/**
 * Adds the entity Id on the paragraph review render.
 *
 * @implements hook_entity_view_alter
 */
function textrazor_entity_view_alter(array &$build, Drupal\Core\Entity\EntityInterface $entity, \Drupal\Core\Entity\Display\EntityViewDisplayInterface $display) {
  // TODO make configurable when it applies
  // TODO move into the textrazor service
  if ($entity->getEntityType()->id() === 'paragraph' && $entity->getType() === 'text' && $display->getMode() === 'preview') {
    $build['#attributes'] += [
      'data-entity-id' => $entity->id(),
    ];
  }
}

/**
 * @implements hook_ENTITY_TYPE_presave
 */
function textrazor_node_presave(Drupal\Core\Entity\EntityInterface $entity) {
  $textrazorManager = \Drupal::service('textrazormanager');
  $entity = $textrazorManager->classifyNode($entity);
}

function textrazor_uninstall() {
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.entities')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.categories')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.dates')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.industries')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.newstopics')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.organizations')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.other_entities')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.people')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.places')->delete();
  \Drupal::configFactory()->getEditable('taxonomy.vocabulary.topics')->delete();
  \Drupal::configFactory()->getEditable('core.entity_form_display.taxonomy_term.newstopics.default')->delete();
  \Drupal::configFactory()->getEditable('core.entity_view_display.taxonomy_term.newstopics.default')->delete();
  \Drupal::configFactory()->getEditable('field.field.taxonomy_term.newstopics.field_newscode')->delete();
  \Drupal::configFactory()->getEditable('field.storage.taxonomy_term.field_newscode')->delete();
  \Drupal::configFactory()->getEditable('migrate_plus.migration.newstopics_importer')->delete();
}
