# This migration uses the source URL using the Elastic Path Cortex API.
id: ep_product
label: Migrate Elastic Path products to commerce product.
status: true
migration_tags:
  - Elastic Path
  - Elastic Path Content
idMap:
  plugin: ep_sync
migration_group: ep
source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: jsonpath
  authentication:
    plugin: oauth2
    base_uri: '!cortex_url'
    token_url: /cortex/oauth2/tokens
    username: '!cortex_username'
    password: '!cortex_password'
    scope: '!cortex_store'
    grant_type: password
    client_id: ep_drupal
    role: REGISTERED
  headers:
    Accept: 'application/json; charset=utf-8'
    Content-Type: 'application/x-www-form-urlencoded'
    x-api-key: '!aws_api_key'
    x-amzn-apigateway-api-id: '!aws_api_id'
  urls:
  item_selector: '$.._element[*]'
  fields:
    -
      name: product_code
      selector: _code..code
      label: 'Product code'
    -
      name: display_name
      selector: '_definition[*]."display-name"'
      label: 'Display Name'
    -
      name: list_price
      selector: '_price.."list-price"[*].amount'
      label: 'List Price'
    -
      name: purchase_price
      selector: '_price.."purchase-price"[*].amount'
      label: 'Purchase Price'
    -
      name: self_uri
      selector: self.uri
      label: 'Json Information object'
  ids:
    self_uri:
      type: string
  constants:
    bundle: default
process:
  title: display_name
  type:
    plugin: default_value
    default_value: default
  uid:
    plugin: default_value
    default_value: 1
  body/format:
    plugin: default_value
    default_value: basic_html
  body/value: display_name
  status:
    plugin: default_value
    default_value: 1
  stores/target_id:
    plugin: default_value
    default_value: 1
destination:
  plugin: 'entity:commerce_product'
  destination_module: commerce_product
migration_dependencies:
  required:
    - ep_product_category
    - ep_product_subcategory
dependencies:
  enforced:
    module:
      - ep
