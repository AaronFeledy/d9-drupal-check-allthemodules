<?php

/**
 * @file
 * Leaner toolbar module.
 */

/**
 * Implements hook_toolbar_alter().
 */
function leaner_toolbar_toolbar_alter(&$items) {
  if (!\Drupal::currentUser()->hasPermission('access the manage tab of the toolbar')) {
    // Always attach the toolbar tree to user, for safety.
    // Usually this resides on the admin menu, so we attach to the user part
    // instead, since we are going to remove the administration tab.
    if (isset($items['user'])) {
      $items['user']['#attached']['library'][] = 'admin_toolbar/toolbar.tree';
      $items['user']['#attached']['library'][] = 'toolbar/toolbar.escapeAdmin';
      // If subtreehash is set, move it to user.
      if (isset($items['administration']['tray']['#attached']['drupalSettings']['toolbar']['subtreesHash'])) {
        $hash = $items['administration']['tray']['#attached']['drupalSettings']['toolbar']['subtreesHash'];
        $items['user']['tray']['#attached']['drupalSettings']['toolbar']['subtreesHash'] = $hash;
      }
    }
    $remove_items = [
      'administration',
    ];
    foreach ($remove_items as $remove_item) {
      if (isset($items[$remove_item])) {
        unset($items[$remove_item]);
      }
    }
  }
  // Change weight of account links.
  if (isset($items['user'])) {
    $items['user']['#weight'] = 300;
    $items['user']['tab']['#title'] = t('Min konto');
  }
}
