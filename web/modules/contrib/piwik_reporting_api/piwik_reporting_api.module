<?php

use GuzzleHttp\Exception\ConnectException;

/**
 * @file
 * Main functions and hook implementations of the Piwik Reporting API module.
 */

/**
 * Returns the API version of the Piwik server.
 *
 * @return bool|string
 *   The API version, or FALSE if an error occurred while connecting to the
 *   Piwik server.
 */
function piwik_reporting_api_get_api_version() {
  /** @var \Piwik\ReportingApi\QueryResult $result */
  $query = \Drupal::service('piwik.query_factory')->getQuery('API.getPiwikVersion');
  try {
    $result = $query->execute();
    if (!$result->hasError() && $result->parameterExists('value')) {
      return $result->get('value');
    }
  }
  catch (ConnectException $e) {
  }

  return FALSE;
}
