<?php
/**
 * @file
 * Core functions for the Dindent module.
 */

/**
 * Implements hook_element_info_alter().
 */
function dindent_element_info_alter(&$type) {
  $type['html']['#post_render'][] = 'dindent_post_render_html';
}

/**
 * Post render callback for Dindent.
 */
function dindent_post_render_html($html, $elements) {
  if (drupal_page_is_cacheable()) {
    $dindent = function_exists('libraries_get_path') ? libraries_get_path('dindent') : 'sites/all/libraries/dindent';
    if (file_exists($dindent . '/Parser.php')) {
      require_once($dindent . '/Parser.php');

      $parser = new \Gajus\Dindent\Parser();
      $html = $parser->indent($html);
    }
  }
  return $html;
}
