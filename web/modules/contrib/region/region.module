<?php

/**
 * @file
 * Module to maintain a common set of regions for layouts.
 */

use Drupal\region\Region;

/**
 * Implements hook_menu().
 */
function region_menu() {
  $items = array();
  $items['admin/structure/regions'] = array(
    'title' => 'Regions',
    'description' => 'Manage list of regions that allow content to be placed.',
    'page callback' => 'region_page_list',
    'access callback' => 'user_access',
    'access arguments' => array('administer regions'),
    'file' => 'region.admin.inc',
  );
  $items['admin/structure/regions/add'] = array(
    'title' => 'Add region',
    'page callback' => 'region_page_add',
    'access callback' => 'user_access',
    'access arguments' => array('administer regions'),
    'type' => MENU_LOCAL_ACTION,
    'file' => 'region.admin.inc',
  );
  $items['admin/structure/regions/region/%region/edit'] = array(
    'title' => 'Edit region',
    'page callback' => 'region_page_edit',
    'page arguments' => array(4),
    'access callback' => 'user_access',
    'access arguments' => array('administer regions'),
    'type' => MENU_CALLBACK,
    'file' => 'region.admin.inc',
  );
  $items['admin/structure/regions/region/%region/delete'] = array(
    'title' => 'Delete',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('region_delete_confirm', 4),
    'access callback' => 'user_access',
    'access arguments' => array('administer regions'),
    'type' => MENU_CALLBACK,
    'file' => 'region.admin.inc',
  );
  return $items;
}

/**
 * Implements hook_permission().
 */
function region_permission() {
  return array(
    'administer regions' => array(
      'title' => t('Administer regions'),
      'description' => t('Manage list of regions available on the site.'),
    ),
  );
}

/**
 * Implements hook_entity_info().
 */
function region_entity_info() {
  $types['region'] = array(
    'label' => 'Region',
    'entity class' => 'Drupal\region\Region',
    'controller class' => 'Drupal\Core\Config\Entity\ConfigStorageController',
    'form controller class' => array(
      'default' => 'Drupal\region\RegionFormController',
    ),
    'list controller class' => 'Drupal\Core\Config\Entity\ConfigEntityListController',
    'list path' => 'admin/structure/regions',
    'uri callback' => 'region_uri',
    'config prefix' => 'region',
    'entity keys' => array(
      'id' => 'id',
      'label' => 'label',
      'uuid' => 'uuid',
    ),
  );
  return $types;
}

/**
 * Entity URI callback.
 *
 * @param Drupal\region\Region $region
 *   Region configuration entity instance.
 *
 * @return array
 *   Entity URI information.
 */
function region_uri(Region $region) {
  return array(
    'path' => 'admin/structure/regions/region/' . $region->id(),
  );
}

/**
 * Load one region object by its identifier.
 *
 * @return Drupal\region\Region
 *   Region configuration entity instance.
 */
function region_load($id) {
  return entity_load('region', $id);
}

/**
 * Load all region objects.
 *
 * @return array
 *   List of Drupal\region\Region instances keyed by id.
 */
function region_load_all() {
  return entity_load_multiple('region');
}
