<?php

/**
 * @file
 * Contains libraries_in_profiles.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function libraries_in_profiles_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the libraries_in_profiles module.
    case 'help.page.libraries_in_profiles':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Check if missing JavaScript/CSS files are included in the active profile. Also in an alternative configurable search path.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_js_alter().
 */
function libraries_in_profiles_js_alter(&$js) {
  $profile = drupal_get_path('profile', drupal_get_profile()) . '/';
  $loc = \Drupal::config('libraries_in_profiles.settings')->get('location');
  foreach ($js as &$script) {
    if (!file_exists($script['data'])) {
      if (file_exists($profile . $script['data'])) {
        $script['data'] = $profile . $script['data'];
      }
      elseif ($loc && file_exists($loc . $script['data'])) {
        $script['data'] = $loc . $script['data'];
      }
    }
  }
}

/**
 * Implements hook_css_alter().
 */
function libraries_in_profiles_css_alter(&$css) {
  $profile = drupal_get_path('profile', drupal_get_profile()) . '/';
  $loc = \Drupal::config('libraries_in_profiles.settings')->get('location');
  foreach ($css as &$style) {
    if (!file_exists($style['data'])) {
      if (file_exists($profile . $style['data'])) {
        $style['data'] = $profile . $style['data'];
      }
      elseif (file_exists($loc . $style['data'])) {
        $style['data'] = $loc . $style['data'];
      }
    }
  }
}
