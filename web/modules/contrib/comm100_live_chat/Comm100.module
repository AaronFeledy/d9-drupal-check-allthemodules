<?php

use Drupal\Component\Utility\Unicode;
use Drupal\Core\Path\PathMatcher;
use Drupal\Core\Url;

function comm100_page_attachments_alter(array &$page) {
 
  $config = \Drupal::config('comm100.settings');
  
  $path = \Drupal::service('path.current')->getPath();
  
  if (empty($config->get('site_id')) || empty($config->get('plan_id'))) {
    return;
  }

  $is_admin_page = true;
  if(!_comm100_active($path))
  {
	  $is_admin_page = false;
  }
   
  $js_settings = [
    'site_id'  => $config->get('site_id'),
    'plan_id' => $config->get('plan_id'),
    'plan_type' => $config->get('plan_type'),
    'main_chatserver_domain' => $config->get('main_chatserver_domain'),
    'standby_chatserver_domain' => $config->get('standby_chatserver_domain'),
    'is_admin_page'	  => $is_admin_page
  ];

  $page['#attached']['drupalSettings']['comm100'] = $js_settings;

  $page['#attached']['library'][] = 'comm100/comm100';
  
}

function _comm100_active($path) {
 
  $page_match = false;
  
  if(strpos($path,"admin")){
	  $page_match = true ; 
  }

  return $page_match;
}

function comm100_theme($existing, $type, $theme, $path) {
  return [
    'comm100_settings' => [
      'variables' => []
    ],
  ];
}
