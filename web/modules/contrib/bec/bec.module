<?php

/**
 * @file
 * The contrib module that allows button "Edit" on the block page.
 */

use Drupal\Core\Url;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Entity\EntityInterface;
use Drupal\block\Entity\Block;

/**
 * Implements hook_form_alter().
 */
function bec_form_block_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  $block = Block::load($form['id']['#default_value']);
  if ($block && $block->getDependencies()["module"][0] === "block_content") {
    $entity = explode(':', $block->getPluginId());
    $block_entity_id = \Drupal::entityManager()->loadEntityByUuid($entity[0], $entity[1])->id();
    $url = Url::fromRoute('entity.block_content.edit_form', ['block_content' => $block_entity_id]);
    $form['actions']['edit'] = [
      '#type' => 'link',
      '#title' => t('Edit'),
      '#url' => $url,
      '#weight' => 8,
      '#attributes' => [
        'class' => ['button'],
      ],
    ];
  }
}

/**
 * Implements hook_entity_operation_alter().
 */
function bec_entity_operation_alter(array &$operations, EntityInterface $entity) {
  if ($entity->getEntityTypeId() === 'block' && $entity->getDependencies()["module"][0] === "block_content") {
    $uuid = explode(":", $entity->getPluginId());
    $block_entity_id = \Drupal::entityManager()->loadEntityByUuid($uuid[0], $uuid[1])->id();
    $url = Url::fromRoute('entity.block_content.edit_form', ['block_content' => $block_entity_id]);
    $operations['edit_content'] = [
      'title' => t('Edit'),
      'weight' => 15,
      'url' => $url,
    ];
  }
}
