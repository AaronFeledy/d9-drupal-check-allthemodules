<?php

use Drupal\Core\Form\FormStateInterface;

define('ENTERPRISE_SEARCH_USER_AGENT', 'a12_find/8.x-0.7');
/**
 * Implements hook_menu_links_discovered_alter().
 */
function enterprise_search_menu_links_discovered_alter(&$links) {
    if (\Drupal::moduleHandler()->moduleExists('search_api')) {
        $links['search_api.overview']['title'] = new \Drupal\Core\StringTranslation\TranslatableMarkup('Enterprise Search');
        $links['search_api.overview']['description'] = new \Drupal\Core\StringTranslation\TranslatableMarkup('Configure enterprise search settings, indexing options and blocks, and manage search environments.');
    }
}

/**
 * Implements hook_help().
 */
function enterprise_search_help($route_name, \Drupal\Core\Routing\RouteMatchInterface $route_match) {
    switch ($route_name) {
        case 'enterprise_search.choose_index':
            $message = 'If you don\'t see an index you\'re expecting to, it may be that the Access Key you are using does not have permission to view it. You can amend this through your account.';
            $message .= 'If you are using \'Enterprise Search\' on more than one website, remember that you can either create a separate index for each site, or configure all sites to use a single common index for multi-site searching.';
            return $message;
    }
    return NULL;
}

/**
 * Implements hook_form_alter().
 */
function enterprise_search_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  if ($form_id == 'search_api_autocomplete_search_edit_form') {
    $form['suggester']['#disabled'] = true;
  }
}

/**
 * Implements hook_page_attachments().
 */
function enterprise_search_page_attachments(array &$attachments) {
    $min_length = Drupal::config('search_api_autocomplete.search_api_autocomplete.search_api_page_enterprise_search')->get('options')['min_length'];
    $attachments['#attached']['drupalSettings']['enterprise_search']['min_length'] = $min_length;
    $attachments['#attached']['library'][] = 'enterprise_search/enterprise_search';
}

