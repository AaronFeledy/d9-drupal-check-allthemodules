<?php

/**
 * Implements hook_entity_type_build().
 */
function entity_form_block_entity_type_build(array &$entity_types) {
  // Add all form handlers from existing form modes.
  $config_factory = \Drupal::configFactory();
  $form_modes = $config_factory->loadMultiple($config_factory->listAll('core.entity_form_mode'));
  foreach ($form_modes as $form_mode) {
    $data = $form_mode->getRawData();
    if (array_key_exists($data['targetEntityType'], $entity_types)) {
      list($entity_type_id, $form_mode_name) = explode('.', $data['id']);
      $entity_types[$data['targetEntityType']]->setFormClass($form_mode_name, $entity_types[$data['targetEntityType']]->getFormClass('default'));
    }
  }
}
