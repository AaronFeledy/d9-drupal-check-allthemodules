services:
  cache_consistent.invalidator:
    class: Drupal\cache_consistent\Cache\CacheConsistentTagsInvalidator
    arguments: ['@settings']
    calls:
      - [setContainer, ['@service_container']]
      - [setTransactionalPhp, ['@transactionalphp']]
    tags:
      - { name: service_collector, call: addInvalidator, tag: cache_tags_invalidator }
      - { name: service_collector, call: addConsistentInvalidator, tag: cache_tags_consistent_invalidator }

  cache_consistent.invalidator.checksum:
    class: Drupal\cache_consistent\Cache\CacheConsistentTagsChecksum
    arguments: ['@transactionalphp']
    tags:
      - { name: cache_tags_consistent_invalidator }

  cache_consistent.buffer_factory:
    class: Drupal\cache_consistent\Cache\CacheConsistentBufferFactory
    calls:
      - [setContainer, ['@service_container']]
      - [setTransactionalPhp, ['@transactionalphp']]
      - [setChecksumProvider, ['@cache_consistent.invalidator.checksum']]

  cache_consistent.factory:
    class: Drupal\cache_consistent\Cache\CacheConsistentFactory
    arguments: ['@settings', '%cache_default_bin_backends%', '%cache_default_consistent_backends%']
    calls:
      - [setContainer, ['@service_container']]
      - [setChecksumProvider, ['@cache_consistent.invalidator.checksum']]

  cache_consistent.scrubber.manager:
    class: Drupal\cache_consistent\Cache\CacheConsistentScrubberManager
    tags:
      - { name: service_collector, call: addCacheScrubber, tag: cache_consistent_scrubber }
