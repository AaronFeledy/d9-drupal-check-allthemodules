<?php

/**
 * @file
 * Contains upload_storage_reminder.module.
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function upload_storage_reminder_help($route_name, RouteMatchInterface $route_match) {
  $output = NULL;

  // Main module help for the upload_storage_reminder module.
  if ($route_name === 'help.page.upload_storage_reminder') {
    $output = '<h3>' . t('About') . '</h3>';
    $output .= '<p>' . t('Modifies the upload storage input field to force the 
    user to select the right file system.') . '</p>';
  }

  return $output;
}

/**
 * Implements hook_form_alter().
 */
function upload_storage_reminder_form_field_storage_config_edit_form_alter(&$form, FormStateInterface &$form_state, $form_id) {
  if (!isset($form['settings']['uri_scheme'])) {
    return;
  }

  // Modify the input field in order to trigger the user to think about the
  // right upload destination.
  $form['settings']['uri_scheme']['#type'] = 'select';
  $form['settings']['uri_scheme']['#required'] = TRUE;
  if (empty($form['settings']['uri_scheme']['#disabled'])) {
    unset($form['settings']['uri_scheme']['#default_value']);
  }

  // Add a reminder to pick the right upload destination.
  $link = \Drupal\Core\Link::createFromRoute(t('provide'), 'system.file_system_settings');
  $form['settings']['uri_scheme']['#description'] = [
    '#type' => 'container',
    'description' => [
      '#markup' => $form['settings']['uri_scheme']['#description'],
    ],
    'reminder' => [
      '#type' => 'container',
      'reminder' => [
        '#markup' => t('When storing sensitive data, make sure to @link a 
        private file system path and select "Private files" as upload 
        destination.', [
          '@link' => $link->toString(),
        ]),
      ],
      '#attributes' => [
        'style' => 'color:red;',
      ],
    ],
  ];
}
