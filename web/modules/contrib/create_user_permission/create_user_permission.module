<?php

/**
 * @file
 * The create user permission module.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function create_user_permission_form_user_register_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  $register_setting = \Drupal::config('user.settings')
    ->get('register');

  if ($register_setting != 'visitors') {
    // Set the admin value to true, so that our user actually gets created with
    // no intervention.
    $form['administer_users']['#value'] = TRUE;
    $form['account']['status']['#default_value'] = 1;
  }
  // Make it possible to send an email to the newly created user.
  $form['account']['notify']['#access'] = \Drupal::currentUser()->hasPermission('create users');
}
