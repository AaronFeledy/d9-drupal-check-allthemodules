<?php

/**
 * Implements hook_field_widget_info_alter().
 *
 * Exposes the pluggable_item widgets for each of the field type's
 * derivatives, since core does not do it automatically.
 *
 * @param array $info
 */
function pluggable_field_widget_info_alter(array &$info) {
  foreach (['pluggable_select', 'pluggable_radios'] as $widget) {
    if (isset($info[$widget])) {
      $field_type_manager = \Drupal::service('plugin.manager.field.field_type');
      foreach ($field_type_manager->getDefinitions() as $key => $definition) {
        if ($definition['id'] == 'pluggable_item') {
          $info[$widget]['field_types'][] = $key;
        }
      }
    }
  }
}

/**
 * Implements hook_field_formatter_info_alter().
 *
 * Exposes the pluggable_default formatter for each of the field
 * type's derivatives, since core does not do it automatically.
 *
 * @param array $info
 */
function pluggable_field_formatter_info_alter(array &$info) {
  if (isset($info['pluggable_default'])) {
    $field_type_manager = \Drupal::service('plugin.manager.field.field_type');
    foreach ($field_type_manager->getDefinitions() as $key => $definition) {
      if ($definition['id'] == 'pluggable_item') {
        $info['pluggable_default']['field_types'][] = $key;
      }
    }
  }
}
