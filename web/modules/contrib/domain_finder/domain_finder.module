<?php

/**
 * @file domain_finder.module
 * 
 * This module generate results showing whether they are free or unavailable.
 */

/**
 * Implements hook_theme().
 */
function domain_finder_theme() {
  return [
    'domain_finder_result' => [
      'variables' => ['result' => NULL],
      'template' => 'domain-finder-result',
    ],
    'domain_finder_results' => [
      'variables' => ['results' => NULL],
      'template' => 'domain-finder-results',
    ],
  ];
}

/**
 * Preprocess variables for domain-finder-result.tpl.php.
 *
 * The $variables array contains the following arguments:
 * - $result: Domain finder result array.
 *
 * @see domain-finder-result.tpl.php
 */
function domain_finder_preprocess_domain_finder_result(&$variables) {
  // Creating variables to domain-finder-result.html.twig
  $result = $variables['result'];
  $variables['domain_name'] = $result['result']['regrinfo']['domain']['name'];
  switch ($result['result']['regrinfo']['registered']) {
    case 'no':
      $variables['domain_attributes'] = 'domain free';
      $variables['output_text'] = t('%domain_name domain is free.', ['%domain_name' => $variables['domain_name']]);
      break;
    case 'n/a':
      $variables['domain_attributes'] = 'domain not-data';
      $variables['output_text'] = t('We are sorry but %domain_name domain has empty result.', ['%domain_name' => $variables['domain_name']]);
      break;
    default:
      $variables['domain_attributes'] = 'domain engage';
      $variables['output_text'] = t('We are sorry but %domain_name domain is unavailable.', ['%domain_name' => $variables['domain_name']]);
      break;
  }

  // More variables available from:
  // $result['regrinfo']
  // $result['regyinfo']
  // $result['rawdata']
}

/**
 * Preprocess variables for domain-finder-results.tpl.php.
 *
 * The $variables array contains the following arguments:
 * - $results: Domain finder results array.
 *
 * @see domain-finder-results.tpl.php
 */
function domain_finder_preprocess_domain_finder_results(&$variables) {
  // Creating variables to domain-finder-results.html.twig
  $results = $variables['results'];
  $variables['domain_finder_results_title'] = t('Results of search');
  $variables['domain_finder_results'] = [];
  foreach ($results['exts'] as $result) {
    $variables['domain_finder_results'][] = ['#theme' => 'domain_finder_result', '#result' => ['result' => $result]];
  }
}
