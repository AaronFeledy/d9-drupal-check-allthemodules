<?php

/**
 * @file
 * PublishThis module that creates pages from curated content,
 * as well as widgets for automated content.
 */

use Drupal\Core\Routing\RouteMatchInterface;

define("PUBLISHTHIS_PT_API_URL", "http://api.publishthis.com/rest");

/**
 * Implements hook_help().
 */
function publishthis_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.publishthis':
      $output = '<h3>' . t('About Publishthis') . '</h3>';
      $output .= '<p>';
      $output .= t('PublishThis module that creates pages from curated content as well as widgets for automated content.');
      $output .= '</p>';
      return $output;
  }
}

/**
 * Implements hook_theme().
 */
function publishthis_theme($existing, $type, $theme, $path) {
  return [
    'publishthis_action' => [
      'variables' => ['data' => NULL],
    ],
  ];
}

/**
 * Implements hook_entity_delete().
 */
function publishthis_entity_delete(Drupal\Core\Entity\EntityInterface $entity) {
  $entity_type = $entity->getEntityTypeId();
  if ($entity_type == 'node') {
    \Drupal::database()->delete('pt_docid_links')
      ->condition('nid', $entity->id())
      ->execute();
  }
}

/**
 * Generate random endpoint.
 */
function publishthis_get_random_word($len = 10) {
  $word = array_merge(range('a', 'z'), range('A', 'Z'));
  shuffle($word);
  return substr(implode($word), 0, $len);
}
