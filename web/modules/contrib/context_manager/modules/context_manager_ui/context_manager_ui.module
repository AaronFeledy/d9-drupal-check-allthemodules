<?php

/**
 * @file
 * Provides a UI for Context Manager.
 */

use Drupal\context_manager_ui\Form\RulesetListForm;
use Drupal\context_manager_ui\Form\RulesetDeleteForm;
use Drupal\context_manager_ui\Wizard\RulesetEdit;
use Drupal\context_manager_ui\Wizard\RulesetAdd;

/**
 * Implements hook_entity_type_build().
 */
function context_manager_ui_entity_type_build(array &$entity_types) {
  /** @var $entity_types \Drupal\Core\Entity\EntityTypeInterface[] */
  $entity_types['context_ruleset']
    ->setListBuilderClass(RulesetListForm::class)
    ->setFormClass('delete', RulesetDeleteForm::class)
    ->setLinkTemplate('collection', '/admin/structure/context_manager')
    ->setLinkTemplate('add-form', '/admin/structure/context_manager/add')
    ->setLinkTemplate('edit-form', '/admin/structure/context_manager/manage/{machine_name}/{step}')
    ->setLinkTemplate('delete-form', '/admin/structure/context_manager/manage/{context_ruleset}/delete')
    //->setLinkTemplate('enable', '/admin/structure/page_manager/manage/{page}/enable')
    //->setLinkTemplate('disable', '/admin/structure/page_manager/manage/{page}/disable')
    ->setHandlerClass('wizard', [
      'add' => RulesetAdd::class,
      'edit' => RulesetEdit::class,
    ]);
}

/**
 * Implements hook_theme().
 */
function context_manager_ui_theme() {
  return [
    // Provides template for the ruleset add/edit form.
    'context_manager_wizard_form' => [
      'render element' => 'form',
    ],
    // Provides template for the menu in the left sidebar of
    // of the ruleset add/edit form.
    'context_manager_wizard_menu' => [
      'variables' => [
        'ruleset_items' => [],
        'plugin_items' => [],
        'wizard' => NULL,
        'cached_values' => NULL,
      ],
      'file' => 'context_manager_ui.theme.inc',
    ],
  ];
}
