<?php

/**
 * @file
 * Roundabout Views module help and theme functions.
 */

use Drupal\views\ViewExecutable;

// Store Roundabout preprocess theme functions in a separate .inc file.
\Drupal::moduleHandler()->loadInclude('roundabout', 'inc', 'roundabout.theme');

/**
 * Implements hook_theme().
 */
function roundabout_theme($existing, $type, $theme, $path) {
  return [
    'roundabout' => [
      'file' => 'roundabout.theme.inc',
    ],
  ];
}

/**
 * Implements hook_help().
 */
function roundabout_help($path, $arg) {
  switch ($path) {
    case 'admin/help#roundabout':
      $output = '<p>' . t('The Roundabout module is a Views style plugin that displays the results in a JQuery Roundabout style.</p>');
      return $output;
  }
}

/**
 * Implements hook_views_pre_render().
 */
function roundabout_views_pre_render(ViewExecutable $view) {
  if (isset($view) && ($view->getStyle()->getPluginId() == 'roundabout')) {
    $view->element['#attached']['library'][] = 'roundabout/integration';
    $view->element['#attached']['drupalSettings']['roundabout']['optionsets'] = [
      '.view-id-' . $view->id() . '.view-display-id-' . $view->current_display => $view->style_plugin->options,
    ];
  }
}

/**
 * Implements hook_libraries_info().
 */
function roundabout_libraries_info() {
  $libraries['roundabout'] = [
    'name' => 'Roundabout',
    'vendor url' => 'https://github.com/fredleblanc/roundabout',
    'download url' => 'https://github.com/fredleblanc/roundabout',
    'version arguments' => [
      'file' => 'jquery.roundabout.min.js',
      // e.g. jQuery Roundabout - v2.3.
      'pattern' => '/jQuery Roundabout - v(\d+\.+\d+(\.+\d+)?)/',
      'lines' => 2,
    ],
    'files' => [
      'js' => [
        'jquery.roundabout.min.js',
      ],
    ],
  ];
  $libraries['easing'] = [
    'name' => 'Easing',
    'vendor url' => 'http://gsgd.co.uk/sandbox/jquery/easing/',
    'download url' => 'http://gsgd.co.uk/sandbox/jquery/easing/',
    'version arguments' => [
      'file' => 'jquery.easing.js',
    ],
    'files' => [
      'js' => [
        'jquery.easing.js',
      ],
    ],
  ];

  return $libraries;
}
