<?php


/**
 * Implements hook_entity_type_build().
 */
function simple_modal_entity_form_entity_type_build(array &$entity_types) {
  foreach ($entity_types as &$entity_type) {
    if ($entity_type instanceof \Drupal\Core\Entity\ContentEntityType) {
      $entity_type->setFormClass('modal', \Drupal\simple_modal_entity_form\Form\ModalEntityForm::class);
    }
  }
}

/**
 * Implements hook_preprocess_HOOK().
 *
 * @param $variables
 */
function simple_modal_entity_form_preprocess_menu_local_action(&$variables) {
  $link = $variables['element']['#link'];
  if (isset($link['localized_options']) && isset($link['localized_options']['attributes']) && isset($link['localized_options']['attributes']['class'])) {
    $classes = $link['localized_options']['attributes']['class'];
    if (in_array('use-ajax', $classes)) {
      $variables['#attached']['library'][] = 'simple_modal_entity_form/simple_modal_entity_form.ajax';
    }
  }
}
