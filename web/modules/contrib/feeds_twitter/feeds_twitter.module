<?php

/**
 * @file
 * Feeds: Twitter hook implementations.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function feeds_twitter_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.feeds_twitter':
      $lines = [];
      $lines[] = t('To get started with Feeds Twitter you\'ll need to create a Twitter app and generate an API key, API secret key, Access Token, and Access token secret.');
      $lines[] = t('First, visit <a href=":url">Twitter\'s developer portal</a> and click "Create an app".', [':url' => 'https://developer.twitter.com/en/apps']);
      $lines[] = t('Give your app a descriptive name, a descriptive description, website URL, and describe your app\'s usage (ie. "This app will import tweets into [site name]")');
      $lines[] = t('Once created under your new app\'s details should bea  "Keys and tokens" tab.');
      $lines[] = t('On that page you can click "Create" under "Access token & access token secret" to create new secret keys.');
      $lines[] = t('Reference the "Keys and tokens" page when creating a new Feed Type with a Twitter fetcher. The bracketed names next to the keys will map directly to fields with the same name.');
      $output = '<h2>' . t('Getting started') . '</h2><p>' . implode('</p><p>', $lines) . '</p>';

      $sample_json = [
        [
          'id' => 1234,
          'is_retweet' => 0,
          'name' => 'lorem_ipsum',
          'screen_name' => 'Lorem',
          'tweet_author_name' => 'lorem_ipsum',
          'tweet_author_scree_name' => 'Lorem',
          'created_at' => date('2018-10-18'),
          'dispaly_date' => date('2018-10-18'),
          'text' => 'This is a sample tweet originating from the selected user\'s timeline.',
          'suggested_title' => 'Tweet by Lorem on 2018-10-18'
        ],
        [
          'id' => 5678,
          'is_retweet' => 1,
          'name' => 'lorem_ipsum',
          'screen_name' => 'Lorem',
          'tweet_author_name' => 'dolores_met',
          'tweet_author_scree_name' => 'Dolores',
          'created_at' => date('2018-10-18'),
          'dispaly_date' => date('2018-04-25'),
          'text' => 'This is a retweet made by Lorem of a tweet by Dolores.',
          'suggested_title' => 'Retweet of Dolores on 2018-10-18'
        ],
      ];

      $output .= '<h2>'. t('Sample simple JSON feed') . '</h2>';
      $output .= t('Feeds Twitter can pass the full API response from Twitter to your JSON parser or a simplified JSON package. Below is an example output of the simplified JSON package.');
      $output .= '<pre>' . json_encode($sample_json, JSON_PRETTY_PRINT) . '</pre>';

      return $output;
  }
}