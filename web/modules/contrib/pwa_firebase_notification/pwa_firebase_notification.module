<?php
/**
 * @file
 */

/**
 * Implements hook_library_info_alter().
 */
function pwa_firebase_notification_library_info_alter(&$libraries, $extension) {
  if ($extension == 'pwa') {
    $libraries['serviceworker']['dependencies'][] = 'pwa_firebase_notification/script';
  }
}

/**
 * Implements hook_page_attachments().
 */
function pwa_firebase_notification_page_attachments(array &$attachments) {
  if (\Drupal::currentUser()->hasPermission('access pwa')) {
    $config = \Drupal::config('firebase.settings');

    if ($config->get('server_key') && $config->get('sender_id')) {
      $attachments['#attached']['drupalSettings']['firebaseConfig'] = [
        'messagingSenderId' => $config->get('sender_id')
      ];
    }
  }
}

/**
 * Implements hook_theme().
 */
function pwa_firebase_notification_theme() {
  return [
    'pwa_firebase_notification_form_block' => [
      'variables' => [
        'config' => [],
      ],
    ],
  ];
}
