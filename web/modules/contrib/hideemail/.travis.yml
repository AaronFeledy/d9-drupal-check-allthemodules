language: php

php:
  - 5.6
  - 7.1

sudo: false

env:
  global:
    - PATH="$PATH:$HOME/.composer/vendor/bin"
    - TESTDIR=$(pwd)
    - DRUPAL_TI_MODULE_NAME="hideemail"
    - DRUPAL_TI_SIMPLETEST_GROUP="hideemail"
    - DRUPAL_TI_DB="drupal_travis_db"
    - DRUPAL_TI_DB_URL="mysql://root@127.0.0.1/$DRUPAL_TI_DB"
    - DRUPAL_TI_WEBSERVER_URL="http://127.0.0.1"
    - DRUPAL_TI_WEBSERVER_PORT="8080"
    - DRUPAL_TI_SIMPLETEST_ARGS="--verbose --color --url $DRUPAL_TI_WEBSERVER_URL:$DRUPAL_TI_WEBSERVER_PORT"
    - DRUPAL_TI_PHPUNIT_CORE_SRC_DIRECTORY="./tests/src"
    - DRUPAL_TI_ENVIRONMENT="drupal-8"

  matrix:
    - DRUPAL_TI_RUNNERS="phpunit"

before_install:
  - composer self-update
  - composer global require "lionsad/drupal_ti:1.*"
  - drupal-ti before_install

install:
  - drupal-ti install
  - composer global require drupal/coder --prefer-dist -vvv || exit 1
  - phpcs --config-set installed_paths "$COMPOSER_VENDOR_PATH/drupal/coder/coder_sniffer"

before_script:
  - drupal-ti before_script
  - DRUPAL_TI_PHPUNIT_ARGS=""

script:
  - drupal-ti script
  - phpcs --standard=Drupal --ignore=vendor/* --warning-severity=0 .
  - php "$TRAVIS_BUILD_DIR/vendor/drush/drush/vendor/bin/phpunit" --configuration "$TRAVIS_BUILD_DIR/vendor/drush/drush/tests" "$TRAVIS_BUILD_DIR/drush/tests"

after_script:
  - drupal-ti after_script

notifications:
  email: false