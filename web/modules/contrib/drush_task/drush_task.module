<?php

/**
 * @file
 *
 * Provide a 'drush task' that can be initiated via rules, triggers and actions.
 *
 * Drush tasks can either be synchonous (immediate response expected)
 * or asynchronous, where the task is put into a queu, run in the background,
 * and the result produces an effect and runs a callback once finished.
 *
 * This module contains the central definition of a 'task' object.
 *
 * Triggering a drush task is set up through 'Rules'.
 */



/**
 * Test the drush status with the given settings.
 *
 * FAPI submit handler.
 */
function drush_task_test_status($form, $form_state) {
  $logger = \Drupal::logger('drush_task');
  $logger->notice('instantiating drush task');

  try {
    /** @var \Drupal\drush_task\DrushTask $task */
    $task = \Drupal::service('drush_task.drush_task');
  }
  catch (Exception $e) {
    drupal_set_message('Failed to load drush_task service - seems to be cache related.');
    return;
  }

  $task->test();
}

/**
 * Ensure the given drush executable is valid.
 *
 * @return string|null
 *   Version on success, NULL on fail.
 */
function drush_task_drush_version() {
  /** @var \Drupal\drush_task\DrushTask $task */
  $task = \Drupal::service('drush_task.drush_task');
  $result = $task->version();
  return $result;
}

