<?php

/**
 * Implements hook_preprocess_menu().
 */
function menu_bullet_info_preprocess_menu(&$variables)
{
  $bullets = \Drupal::state()->get('bullet_info');
  foreach ($variables['items'] as $key => $item) {
      if(array_key_exists($key,$bullets)){
        $bullet = $bullets[$key];
        $view_info = explode('#',$bullet);
        if(count($view_info)==2){
            $view = \Drupal\views\Views::getView($view_info[0]);
            $view->get_total_rows = TRUE;
            $view->execute($view_info[1]);
            $bullet_info_value = $view->total_rows;
            $item['attributes']->setAttribute('class', array('bullet-info'));
            $item['attributes']->setAttribute('data-bullet', $bullet_info_value);
        }
      }
  }
}

/**
 * Implements hook_page_attachments_alter().
 */
function menu_bullet_info_page_attachments_alter(&$build){
  $build['#attached']['library'][] = 'menu_bullet_info/menu-bullet-info';
}
