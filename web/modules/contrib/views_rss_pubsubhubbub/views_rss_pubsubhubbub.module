<?php

/**
 * @file
 * Provides PubSubHubbub namespace and <channel> element for Views RSS module.
 */

/**
 * Implements hook_views_rss_channel_elements_alter().
 */
function views_rss_pubsubhubbub_views_rss_channel_elements_alter(&$elements) {
  $elements['views_rss_core']['atom:link'] = array(
    'title' => t('link'),
    'description' => t("A link indicating feed's update hub."),
    'preprocess functions' => array('views_rss_pubsubhubbub_preprocess_channel_link'),
    'default_value' => 'http://pubsubhubbub.appspot.com',
    'help' => 'http://code.google.com/p/pubsubhubbub/wiki/RssFeeds',
  );
}

/**
 * Implements hook_views_rss_namespaces_alter().
 */
function views_rss_pubsubhubbub_views_rss_namespaces_alter(&$namespaces) {
  $namespaces['atom'] = 'http://www.w3.org/2005/Atom';
}

/**
 * Preprocess function for channel <atom:link> element.
 */
function views_rss_pubsubhubbub_preprocess_channel_link($variables) {
  foreach ($variables['elements'] as $delta => $element) {
    if (!empty($variables['elements'][$delta]['value'])) {
      $variables['elements'][$delta]['attributes'] = array(
        'rel' => 'hub',
        'href' => $element['value'],
      );
      unset($variables['elements'][$delta]['value']);
    }
  }
}
