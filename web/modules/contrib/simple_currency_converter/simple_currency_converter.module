<?php
/**
 * @file
 * Add a simple currency converter to your site.
 */

/**
 * Implements hook_preprocess().
 */
function simple_currency_converter_preprocess(&$variables, $hook) {
  if ($hook == 'html') {
    $config_factory = \Drupal::service('config.factory');
    $config = $config_factory->get('simple_currency_converter.settings');

    $window_id = $config->get('window_id');
    $window_trigger = $config->get('window_trigger');
    $window_title = $config->get('window_title');
    $conversion_selector = $config->get('conversion_selector');
    $disclaimer = $config->get('disclaimer');
    $default_conversion_currency = $config->get('default_conversion_currency');
    $cookie_expiration = $config->get('cookie_expiration');

    module_load_include('inc', 'simple_currency_converter', 'simple_currency_converter.currency');

    $country_info = simple_currency_converter_supply_country_info();

    $variables['page_bottom']['simple_currency_converter'] = [
      '#theme' => 'simple_currency_converter_configurator',
      '#window_id' => $window_id,
      '#disclaimer' => $disclaimer,
      '#attached' => [
        'library' => [
          'core/jquery.ui.dialog',
          'simple_currency_converter/core',
        ],
        'drupalSettings' => [
          'simple_currency_converter' => [
            'window_id' => $window_id,
            'window_trigger' => $window_trigger,
            'window_title' => $window_title,
            'conversion_selector' => $conversion_selector,
            'disclaimer' => $disclaimer,
            'default_conversion_currency' => $default_conversion_currency,
            'cookie_expiration' => $cookie_expiration,
            'country_info' => $country_info,
          ],
        ],
      ],
    ];
  }
}

/**
 * Implements hook_theme().
 */
function simple_currency_converter_theme($existing, $type, $theme, $path) {
  return [
    'simple_currency_converter_configurator' => [
      'template'  => 'simple-currency-converter-configurator',
      'variables' => [
        'window_id' => NULL,
        'disclaimer' => NULL,
      ],
    ],
  ];
}
