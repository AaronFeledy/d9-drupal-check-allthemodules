<?php

/**
 * Implements HOOK_page_attachments(array &$page)
 *
 * @param array $page
 */
function accessiblizer_page_attachments(array &$page) {

  $config = \Drupal::config('accessiblizer.settings');
  $activate_accessiblizer = $config->get('activate_accessiblizer', NULL);
  $activate_accessiblizer_admin_panel = $config->get('activate_accessiblizer_admin_panel', NULL);
  $accessiblizer_code = $config->get('accessiblizer_code', NULL);

  if ($activate_accessiblizer) {
    $route = \Drupal::routeMatch()->getRouteObject();
    if ($activate_accessiblizer_admin_panel) {
      _accessiblizer_add_accessiblizer_js($page, $accessiblizer_code);
    }
    else if (!\Drupal::service('router.admin_context')->isAdminRoute($route)) {
      _accessiblizer_add_accessiblizer_js($page, $accessiblizer_code);
    }
  }
}

/**
 * Few more conditional add either default JS file OR custom js code.
 *
 * @param array $page
 * @param $accessiblizer_code
 */
function _accessiblizer_add_accessiblizer_js(array &$page, $accessiblizer_code = NULL) {
  if (isset($accessiblizer_code) && $accessiblizer_code) {
    $page['#attached']['html_head'][] = [
        [
            '#tag' => 'script',
            '#value' => $accessiblizer_code,
        ],
        'accessiblizer_script'
    ];
  }
  else {
    $page['#attached']['library'][] = 'accessiblizer/accessiblizer.displayJs'; //drupal_get_path('module', 'accessiblizer').'/js/accessiblizer.js'; // Default Accessiblizer js, located at 'accessiblizer/js'
  }
  return TRUE;
}