<?php

/**
 * @file
 * Contains devel_clipboard.module.
 */

/**
 * Implements hook_form_FORM_ID_alter().
 */
function devel_clipboard_form_devel_execute_form_alter(&$form) {
  $form['#attached']['library'][] = 'devel_clipboard/devel';
}

/**
 * Implements hook_cron().
 *
 * It will delete the exceeded count of files which is mentioned
 * in the devel clipboard's settings page.
 */
function devel_clipboard_cron() {
  $dir_uri = 'private://devel_clipboard';
  $file_list = file_scan_directory($dir_uri, '/.*\.txt$/', $options = [], $depth = 0);
  foreach ($file_list as $value) {
    $uris[$value->name] = $value->uri;
  }
  krsort($uris, SORT_NUMERIC);
  $clipboardCount = \Drupal::config('devel_clipboard.settings')->get('clipboardCount');
  $sliced_uris = array_slice($uris, $clipboardCount);
  foreach ($sliced_uris as $uri) {
    $result = file_unmanaged_delete($uri);
    if ($result !== TRUE) {
      \Drupal::logger('devel_clipboard')->notice('Devel clipboard files not deleted.');
    }
  }
}
