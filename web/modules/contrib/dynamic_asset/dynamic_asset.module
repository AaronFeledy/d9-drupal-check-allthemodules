<?php

/**
 * @file
 * Contains dynamic_asset.module.
 */


/**
 * Implements hook_css_alter().
 */
function dynamic_asset_css_alter(&$css, \Drupal\Core\Asset\AttachedAssetsInterface $assets) {
  foreach ($css as $name => &$options) {
    if ($options['type'] === 'dynamic' && array_key_exists('route', $options) && $options['route'] && is_string($options['route'])) {
      $options['data'] = \Drupal::urlGenerator()->generateFromRoute($options['route']);
      // render should be done like an external css
      $options['type'] = 'external';
      // CSS files are being keyed by the full path.
      $css[$options['data']] = $options;
      unset($css[$name]);
    }
  }
}


/**
 * Implements hook_js_alter().
 */
function dynamic_asset_js_alter(&$javascript, \Drupal\Core\Asset\AttachedAssetsInterface $assets) {
  foreach ($javascript as $name => &$options) {
    if ($options['type'] === 'dynamic' && array_key_exists('route', $options) && $options['route'] && is_string($options['route'])) {
      $options['data'] = \Drupal::urlGenerator()->generateFromRoute($options['route']);
      // render should be done like an external js
      $options['type'] = 'external';
      // Javascript files are being keyed by the full path.
      $javascript[$options['data']] = $options;
      unset($javascript[$name]);
    }
  }
}