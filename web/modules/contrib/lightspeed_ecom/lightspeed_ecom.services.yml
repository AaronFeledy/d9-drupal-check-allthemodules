services:
  lightspeed.ecom.client:
    class: WebshopAppApiException
    factory: lightspeed.ecom.client_factory:getClient
    arguments: [default]

  lightspeed.ecom.client_factory:
    class: Drupal\lightspeed_ecom\Service\ApiClientFactory
    arguments: ['@entity_type.manager', '@language_manager']

  lightspeed.ecom.security_token:
    class: Drupal\lightspeed_ecom\Service\SecurityTokenGenerator
    arguments: ["@private_key"]

  lightspeed.ecom.webhook_registry:
    class: Drupal\lightspeed_ecom\Service\WebhookRegistry
    arguments:
     - "@event_dispatcher"
     - "@lightspeed.ecom.client_factory"
     - "@logger.channel.lightspeed_ecom"
     - "@lightspeed.ecom.security_token"
     - "@cache.static"
     - "@url_generator"

  # Remove when https://www.drupal.org/node/2786941 is fixed
  lightspeed.ecom.webhook_access_check:
    class: Drupal\lightspeed_ecom\Controller\WebhookController
    arguments: ['@lightspeed.ecom.webhook_registry', '@lightspeed.ecom.security_token']
    tags:
      - { name: access_check, applies_to: _webhook_access_check }

  logger.channel.lightspeed_ecom:
    parent: logger.channel_base
    arguments: ['lightspeed_ecom']