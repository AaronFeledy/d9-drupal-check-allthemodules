<?php

/**
 * @file
 * Require Login by Site Filter.
 *
 * Supplies the filter logic based on configuration settings.
 */

/**
 * Implements hook_required_login_authcheck_alter().
 */
function require_login_by_site_require_login_authcheck_alter(&$checks) {
  // ksm($checks);
  $config = \Drupal::config('require_login_by_site.config');
  // ksm($config);
  // Skip if filter is not enabled.
  if ($config->get('enabled') !== 1) {
    return;
  }
  // Type = 0 is require login for named domains.
  $filter_type = $config->get('filter_type');
  // Allow access if host is defined as an allow anonyous domain.
  $domains = explode(PHP_EOL, $config->get('domains'));
  if (in_array(strtolower(\Drupal::request()->getHost()), $domains)) {
    $checks[] = $filter_type === 1 ? TRUE : FALSE;
  }
  else {
    $checks[] = $filter_type === 0 ? TRUE : FALSE;;
  }
}
