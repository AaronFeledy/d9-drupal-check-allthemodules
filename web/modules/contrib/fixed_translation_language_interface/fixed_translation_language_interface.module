<?php

/**
 * @file
 * Module file for this module.
 */

/**
 * Implements hook_link_alter().
 */
/**
 * Implements hook_link_alter().
 */
function fixed_translation_language_interface_link_alter(&$variables) {
  if (empty($variables['url'])) {
    // Not sure why that would be.
    return;
  }
  /** @var \Drupal\Core\Url $url */
  $url = $variables['url'];
  if (!$url->isRouted()) {
    // Nothing to do there then.
    return;
  }
  if (!preg_match('/^entity\.[\w].*\.content_translation_add$/', $url->getRouteName())) {
    // We dont care.
    return;
  }
  // Always set the current language as the language of the link.
  $current_language = \Drupal::languageManager()->getCurrentLanguage();
  $variables['options']['language'] = $current_language;
}
