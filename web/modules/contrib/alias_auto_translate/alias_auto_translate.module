<?php

/**
 * @file
 * Contains alias_auto_translate.module..
 */

/**
 * Implements hook_help().
 */
function alias_auto_translate_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the alias_auto_translate module.
    case 'help.page.alias_auto_translate':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Translate alias atutomatic') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_form_alter().
 */
function alias_auto_translate_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  // Getting the Current Url.
  $path = \Drupal::request()->getpathInfo();
  $arg = explode('/', $path);
  // Fetch all the content type Name.
  $contentTypes = \Drupal::service('entity.manager')->getStorage('node_type')->loadMultiple();
  $contentTypesList = [];
  // Converting content type name in to Array.
  foreach ($contentTypes as $contentType) {
    $contentTypesList[] = 'node_' . $contentType->id() . '_form';
  }
  // Chekcing the form Id and it should not be add form.
  // It should be add Add Transation form.
  if (in_array($form_id, $contentTypesList) && $arg[count($arg) - 2] !== 'add') {
    $node_id = $arg[count($arg) - 5];
    $result = \Drupal::service('path.alias_manager')->getAliasByPath('/node/' . $node_id, $arg[count($arg) - 2]);
    // IF patht not set then don't add it.
    if ($result != '/node/' . $node_id) {
      $form['path']['widget'][0]['alias']['#default_value'] = $result;
    }
    return $form;
  }
}
