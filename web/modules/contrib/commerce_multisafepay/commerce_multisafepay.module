<?php
 /**
 * Copyright Â© 2018 MultiSafepay, Inc. All rights reserved.
 * See DISCLAIMER.md for disclaimer details.
 */

use Drupal\Core\Form\FormStateInterface;


/**
 * Alter a form
 *
 * Implements hook_form_alter().
 *
 * @param                    $form
 * @param FormStateInterface $form_state
 * @param                    $form_id
 */
function commerce_multisafepay_form_alter(&$form, FormStateInterface $formState, $formId) {

    //Check if the page is on review page
    if (!empty($form['#step_id']) && $form['#step_id'] == 'review') {
        //Get Build info
        $buildInfo = $formState->getBuildInfo();

        //Get Order
        $order = $buildInfo['callback_object']->getOrder();

        //Get the Gateway
        $paymentGateway = $order->payment_gateway->entity;

        //Check if the payment method is msp_ideal
        if (isset($paymentGateway) && $paymentGateway->getPluginId() === 'msp_ideal') {
            $form['actions']['next']['#value'] = t('Proceed to next step to choose your bank');
        }
    }
}