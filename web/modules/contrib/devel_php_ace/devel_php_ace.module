<?php
/**
 * @file
 * Add Ace Editor to Devel Execute PHP forms.
 */

/**
 * Implements hook_form_alter().
 *
 * TODO Update for D8.
 */
function devel_php_ace_form_alter(&$form, &$form_state, $form_id) {
  $config = \Drupal::config('devel_php_ace.settings');

  switch ($form_id) {
    case 'devel_execute_block_form':
    case 'devel_execute_form':
      $form['execute']['code']['#attached']['library'][] = 'devel_php_ace/ace-editor';

      $form['execute']['code']['#attached']['drupalSettings']['develPHPAce'] = [
        'theme' => $config->get('theme'),
      ];

      $form['execute']['code']['#attributes']['class'][] = 'ace-enabled';
      $form['execute']['code']['#resizable'] = FALSE;
      break;
  }
}

/**
 * Helper function to get available themes from ACE.
 *
 * TODO Update to use D8 config and libraries methods.
 */
function devel_php_ace_get_themes() {
  $library_path = libraries_get_path('ace') . '/src';
  $files = array_keys(file_scan_directory($library_path, '/^theme-.*\.js$/i', array('key' => 'name')));
  $themes = array();

  foreach ($files as $filename) {
    $theme = explode('theme-', $filename);
    $themes[] = $theme[1];
  };

  asort($themes);

  return array_combine($themes, $themes);
}
