<?php
/**
 * @file
 * Module file for miniOrange OAuth client Module.
 */
use Symfony\Component\HttpFoundation\RedirectResponse;
/**
* Implements hook_menu().
*/
/*
function miniorange_oauth_client_user_login($account)
{
  $miniorange_oauth_client_red = \Drupal::config('miniorange_oauth_client.settings')->get('miniorange_oauth_client_red');
  $response = new RedirectResponse($miniorange_oauth_client_red);
	$response->send();
}
*/
function miniorange_oauth_client_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  global $base_url;
  if(!empty(\Drupal::config('miniorange_oauth_client.settings')->get('miniorange_oauth_client_base_url')))
    $baseUrlValue = \Drupal::config('miniorange_oauth_client.settings')->get('miniorange_oauth_client_base_url');
  else
    $baseUrlValue = $base_url;
  if(($form_id == 'user_login_block') || ($form_id == 'user_login_form'))
    {
      if(!empty(\Drupal::config('miniorange_oauth_client.settings')->get('miniorange_auth_client_app_name')))
      {
      $oauth_login_url = $baseUrlValue . '/moLogin';
      $server_name = \Drupal::config('miniorange_oauth_client.settings')->get('miniorange_auth_client_app_name');
      $form['loginurl']= array(array(
        '#markup' => '<a href="'. $oauth_login_url .'">Login using ' . $server_name . '</a>'
      ));
     }
    }
}
