<?php

/**
 * @file
 * Contains seo_manager.module.
 */

use Drupal\Core\Form\FormStateInterface;
use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Url;

/**
 * Implements hook_help().
 */
function seo_manager_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the SEO manager module.
    case 'help.page.seo_manager':
      $output = '<h2>' . t('About') . '</h2>';
      $output .= '<p>' . t('SEO Manager is an installer module that helps you install a collection of modules and configure them once.') . '</p>';
      $output .= '<h3>' . t('Dependencies modules:') . '</h3>';
      $output .= '<ul>';
      $output .= '<li>' . t('<a href=":defaults">RDF</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'rdf'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Pathauto</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'pathauto'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Redirect</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'redirect'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Metatag</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'metatag'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Schema.org Metatag</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'schema_metatag'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Simple XML Sitemap</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'simple_sitemap'])->toString()]) . '</li>';
      $output .= '<li>' . t('<a href=":defaults">Google Analytics</a>', [':defaults' => Url::fromRoute('help.page', ['name' => 'google_analytics'])->toString()]) . '</li>';
      $output .= '<li>' . t('Real-time SEO for Drupal "yoast_seo"') . '</li>';

      $output .= '</ul>';

      return $output;
  }
}

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */
function seo_manager_form_node_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  if (isset($form['field_yoast_seo']) &&
      isset($form['field_yoast_seo']['widget']) &&
      isset($form['field_yoast_seo']['widget']['0']) &&
      isset($form['field_yoast_seo']['widget']['0']['yoast_seo'])) {
    $form['field_yoast_seo']['widget']['0']['yoast_seo']['#title'] = t('Real-time SEO');
  }
}

/**
 * Implements hook_form_BASE_FORM_ID_alter().
 */
function seo_manager_form_system_modules_uninstall_confirm_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  $warning_msg = '<b>Important note: SEO Manager</b> module is an installer module that helps you install a collection of modules and configure them once, so please make sure to <b>uninstall the following modules</b> after uninstalling <b>SEO Manager</b> module to remove module effect completely:<br />';
  $warning_msg .= '<ul>';
  $warning_msg .= '<li><b>yoast_seo</b></li>';
  $warning_msg .= '<li><b>simple_sitemap</b></li>';
  $warning_msg .= '<li><b>google_analytics</b></li>';
  $warning_msg .= '<li><b>redirect_404</b></li>';
  $warning_msg .= '<li><b>redirect</b></li>';
  $warning_msg .= '<li><b>schema_web_site</b></li>';
  $warning_msg .= '<li><b>schema_web_page</b></li>';
  $warning_msg .= '<li><b>schema_item_list</b></li>';
  $warning_msg .= '<li><b>schema_article</b></li>';
  $warning_msg .= '<li><b>schema_metatag</b></li>';
  $warning_msg .= '<li><b>metatag_verification</b></li>';
  $warning_msg .= '<li><b>metatag_twitter_cards</b></li>';
  $warning_msg .= '<li><b>metatag_open_graph</b></li>';
  $warning_msg .= '<li><b>metatag_mobile</b></li>';
  $warning_msg .= '<li><b>metatag_hreflang</b></li>';
  $warning_msg .= '<li><b>metatag_google_plus</b></li>';
  $warning_msg .= '<li><b>metatag_facebook</b></li>';
  $warning_msg .= '<li><b>metatag_views</b></li>';
  $warning_msg .= '<li><b>metatag</b></li>';
  $warning_msg .= '</ul><br />';
  $warning_msg .= '<b>Recommended:</b> If you are using Drush 9+, you can simply <b>uninstall SEO Manager with all dependencies</b> by run <b><em>"drush seo_manager:uninstall"</em><b>.';

  // Show warninng when uninstalling SEO Manager module.
  foreach ($form['modules']['#items'] as $item) {
    if ($item == 'SEO Manager') {
      drupal_set_message(t($warning_msg), 'warning');
    }
  }
}
