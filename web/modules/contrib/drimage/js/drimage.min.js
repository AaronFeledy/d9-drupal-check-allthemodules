!function(o,g){"use strict";g.drimage={},g.drimage.findDelayParent=function(e){return null===e.parentNode?null:e.parentNode.classList&&e.parentNode.classList.contains("js-delay-drimage")?e.parentNode:g.drimage.findDelayParent(e.parentNode)},g.drimage.resize=function(e,t,a){if(0===e[a])return e;var i={0:e[0],1:e[1]};i[a]=t;var r=Math.abs(a-1);return 0===e[r]||(i[r]=Math.round(i[r]*(i[a]/e[a]))),i},g.drimage.fetchData=function(e){var t=JSON.parse(e.getAttribute("data-drimage"));return t.upscale=parseInt(t.upscale),t.downscale=parseInt(t.downscale),t.threshold=parseInt(t.threshold),t},g.drimage.size=function(e){if(0===e.offsetWidth)return{0:0,1:0};var t=g.drimage.fetchData(e),a={0:e.offsetWidth,1:0};if("aspect_ratio"===t.image_handling&&(a[1]=a[0]/t.aspect_ratio.width*t.aspect_ratio.height),"background"===t.image_handling&&"cover"===t.background.size){var i=e.querySelectorAll("img");if(0<i.length){var r=parseInt(i[0].getAttribute("width")),n=parseInt(i[0].getAttribute("height"))/r*a[0];n<e.offsetHeight&&(a[0]=a[0]/n*e.offsetHeight)}}var d=1;1===t.multiplier&&(d=Number(window.devicePixelRatio),(!0===isNaN(d)||d<=0)&&(d=1)),a[0]=Math.round(a[0]*d),a[1]=Math.round(a[1]*d),a[0]<t.upscale&&(a=g.drimage.resize(a,t.upscale,0));var o=a[0]-t.upscale,s=Math.ceil(o/t.threshold)*t.threshold+t.upscale;if(1<d){var l=Math.floor(o/t.threshold)*t.threshold+t.upscale;l>=a[0]/d&&(s=l)}return(a=g.drimage.resize(a,s,0))[0]>t.downscale&&(a=g.drimage.resize(a,t.downscale,0)),a},g.drimage.init=function(e){void 0===e&&(e=o);var t=e.querySelectorAll(".drimage");if(0<t.length)for(var a=0;a<t.length;a++){var i=g.drimage.fetchData(t[a]);if("aspect_ratio"===i.image_handling){var r=t[a].querySelectorAll("img");if(0<r.length){var n=parseInt(r[0].getAttribute("width"))/i.aspect_ratio.width*i.aspect_ratio.height;r[0].setAttribute("height",n)}}"background"===i.image_handling&&(t[a].classList.contains("is-background-image")||(t[a].style.backgroundAttachment=i.background.attachment,t[a].style.backgroundPosition=i.background.position,t[a].style.backgroundSize=i.background.size,t[a].classList.add("is-background-image"))),g.drimage.renderEl(t[a])}},g.drimage.renderEl=function(t){if(null===g.drimage.findDelayParent(t)){var e=t.getBoundingClientRect(),a=g.drimage.fetchData(t);if((0<=e.top+a.lazy_offset&&e.top-a.lazy_offset<=(window.innerHeight||o.documentElement.clientHeight)||0<=e.bottom+a.lazy_offset&&e.bottom-a.lazy_offset<=(window.innerHeight||o.documentElement.clientHeight))&&!1===isNaN(a.fid)&&a.fid%1==0&&0<Number(a.fid)){var i=g.drimage.size(t),r=Number(t.getAttribute("data-w")),n=Number(t.getAttribute("data-h"));if((i[0]!==r||i[1]!==n)&&0<i[0]){t.classList.add("is-loading"),t.setAttribute("data-w",i[0]),t.setAttribute("data-h",i[1]);var d=new Image;d.onload=function(){var e=t.querySelectorAll("img");0<e.length&&(e[0].src=this.src),"background"===a.image_handling&&(t.style.backgroundImage='url("'+this.src+'")'),t.classList.remove("is-loading")},d.src="/drimage/"+i[0]+"/"+i[1]+"/"+a.fid+"/"+encodeURIComponent(a.filename)}}}},g.behaviors.drimage={attach:function(e){var t;g.drimage.init(e),addEventListener("resize",function(){clearTimeout(t),t=setTimeout(g.drimage.init,100)}),addEventListener("scroll",function(){g.drimage.init(o)})}}}(document,Drupal);