<?php

/**
 * @file
 * Contains inherit_link.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function inherit_link_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the inherit_link module.
    case 'help.page.inherit_link':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Inherit Link') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_page_attachments().
 */
function inherit_link_page_attachments(array &$page) {

  // Prevent exception if entity is not defined: when "inherit_link_ui" is not
  // installed.
  $module_handler = \Drupal::service('module_handler');
  $entity_module = $module_handler->moduleExists('inherit_link_ui');

  // Load all config entities and set to settings to execute.
  $list = $entity_module ? \Drupal::entityQuery('inherit_link')->execute() : [];
  // @NOTE Library not attached with no entities, assuming custom usement in
  // that scenario.
  if (!empty($list)) {
    $inherit_link_list = \Drupal::entityTypeManager()->getStorage('inherit_link')->loadMultiple(array_keys($list));

    foreach ($inherit_link_list as $config) {
      /* @var $config \Drupal\inherit_link_ui\Entity\InheritLink */
      $page['#attached']['drupalSettings']['inherit_link'][$config->id()] = $config->getAttributes();
    }
    // Add library.
    $page['#attached']['library'][] = 'inherit_link/inherit_link';
  }
}
