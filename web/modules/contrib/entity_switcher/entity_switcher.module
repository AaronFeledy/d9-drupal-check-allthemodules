<?php

/**
 * @file
 * Code for the Entity Switcher module.
 */

/**
 * Implements hook_theme().
 */
function entity_switcher_theme() {
  $theme = [];

  $theme['entity_switcher_wrapper'] = [
    'render element' => 'element',
    'template' => 'entity-switcher-wrapper',
  ];
  $theme['entity_switcher'] = [
    'render element' => 'element',
    'template' => 'entity-switcher',
  ];

  return $theme;
}

/**
 * Implements hook_preprocess_HOOK() for 'entity_switcher_wrapper'.
 */
function entity_switcher_preprocess_entity_switcher_wrapper(&$variables) {
  $element = &$variables['element'];

  // This function is invoked as theme wrapper, but the rendered form element
  // may not necessarily have been processed by
  // \Drupal::formBuilder()->doBuildForm().
  $element += [
    '#title_display' => 'before',
    '#wrapper_attributes' => [],
    '#label_attributes' => [],
  ];
  $variables['attributes'] = $element['#wrapper_attributes'];

  // Pass elements #type and #name to template.
  if (!empty($element['#type'])) {
    $variables['type'] = $element['#type'];
  }
  if (!empty($element['#name'])) {
    $variables['name'] = $element['#name'];
  }

  // Pass elements disabled status to template.
  $variables['disabled'] = !empty($element['#attributes']['disabled']) ? $element['#attributes']['disabled'] : NULL;

  // Suppress error messages.
  $variables['errors'] = NULL;

  // If #title is not set, we don't display any label.
  if (!isset($element['#title'])) {
    $element['#title_display'] = 'none';
  }

  $variables['title_display'] = $element['#title_display'];

  $variables['prefix'] = isset($element['#field_prefix']) ? $element['#field_prefix'] : NULL;
  $variables['suffix'] = isset($element['#field_suffix']) ? $element['#field_suffix'] : NULL;

  // If switcher is not accessible, just do not add it.
  $variables['children'] = ($element['#access_switcher'] === TRUE) ? $element['#children'] : [];
}
