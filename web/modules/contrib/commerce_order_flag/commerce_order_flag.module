<?php

/**
 * @file
 * Module for providing flag to orders view.
 */

/**
 * Implements hook_views_data_alter().
 */
function commerce_order_flag_views_data_alter(&$data) {

  $config = \Drupal::config('commerce_order_flag.settings');
  $commerce_flag_label = $config->get('flag_label');

  $data['commerce_order']['commerce_order_flag'] = [
    'title' => t($commerce_flag_label),
    'field' => [
      'title' => t($commerce_flag_label),
      'help' => t('Flags a specific order.'),
      'id' => 'commerce_order_flag',
    ],
  ];
}

/**
 * Implements hook_form_alter().
 */
function commerce_order_flag_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {

  if ($form_id == 'views_form_commerce_orders_page_1') {

    $config = \Drupal::config('commerce_order_flag.settings');
    $flag_bulk_set = $config->get('flag_bulk_set');
    $flag_bulk_unset = $config->get('flag_bulk_unset');

    foreach ($form['header']['commerce_order_bulk_form']['action']['#options'] as $key => $value) {

      ($key == 'order_set_sent' ? $form['header']['commerce_order_bulk_form']['action']['#options'][$key] = t($flag_bulk_set) : FALSE);
      ($key == 'order_unset_sent' ? $form['header']['commerce_order_bulk_form']['action']['#options'][$key] = t($flag_bulk_unset) : FALSE);

    }
  }
}
