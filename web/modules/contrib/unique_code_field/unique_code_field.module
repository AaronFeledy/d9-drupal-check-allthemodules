<?php

/**
 * @file
 * Contains unique_code_field.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\Core\Form\FormStateInterface;
use Drupal\Component\Utility\Html;

/**
 * Implements hook_help().
 */
function unique_code_field_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the unique_code_field module.
    case 'help.page.unique_code_field':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Adds a new field to allow user unique code') . '</p>';
      return $output;

    default:
  }
}

/**
 * Form element validate handler for Unique Code element.
 *
 * Check the code's length. If these validations are passed the code will be
 * sanitized with Html::escape method from Drupal, just in case.
 */
function unique_code_validate($element, FormStateInterface $form_state) {
  $field_length = strlen($element['#value']);
  $max_length = (int) $element['#maxlength'];
  if ($field_length === $max_length) {
    $sane_str = Html::escape($element['#value']);
    $form_state->setValueForElement($element, $sane_str);
  }
}
