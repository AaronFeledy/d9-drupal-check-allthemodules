image: yanniboi/drupal

variables:
  MYSQL_USER: root
  MYSQL_PASSWORD: password
  MYSQL_DATABASE: bookkeeping_test_runner
  COMPOSER_CACHE_DIR: "$CI_PROJECT_DIR/.cache/composer"
  COMPOSER_EXIT_ON_PATCH_FAILURE: 1

cache:
  paths:
    - .cache

# General set up of our environment and code.
before_script:
- composer self-update
- export DRUPAL_BUILD_ROOT="$(dirname "$CI_PROJECT_DIR")"
- ./.gitlab-ci/setup.sh
- cd $DRUPAL_BUILD_ROOT/drupal
- TESTDIR=$(pwd)

code_review:
  script:
  - cd $TESTDIR
  - $TESTDIR/vendor/bin/phpcs --config-set installed_paths $TESTDIR/vendor/drupal/coder/coder_sniffer
  - $CI_PROJECT_DIR/.gitlab-ci/coder.sh

phpunit:
  script:
  - cd $TESTDIR
  - $CI_PROJECT_DIR/.gitlab-ci/phpunit.sh
