<?php
/**
 * @file
 * Permission Report main module file.
 */

use Drupal\user\UserInterface;
use Drupal\Core\Entity\Display\EntityViewDisplayInterface;
use Drupal\Core\Url;

/**
 * Implements hook_ENTITY_TYPE_view().
 */
function permission_report_user_view(array &$build, UserInterface $account, EntityViewDisplayInterface $display) {
  if (\Drupal::currentUser()->hasPermission('view permission report')) {
    $link_generator = \Drupal::service('link_generator');
    $build['permission_report'] = array(
      '#title' => t('Resultant Set of Permissions'),
      '#markup' => $link_generator->generate(t('View permission report for %user', array('%user' => $account->getDisplayName())), new Url('permission_report.user', ['user' => $account->id()])),
      '#attributes' => array('class' => 'permission_report'),
    );
  }
}
