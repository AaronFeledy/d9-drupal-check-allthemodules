<?php

/**
 * @file
 * General functions and hook implementations.
 *
 * @see http://harvesthq.github.com/chosen/
 */

/**
 * Implements hook_library_info_alter().
 */
function superselect_lib_library_info_alter(array &$libraries, $module) {
  if ('superselect_lib' == $module) {
    if (isset($libraries['superselect'])) {
      // Set chosen library path.
      $superselect_js_path = _superselect_lib_get_path();
      $minified = file_exists($superselect_js_path . '/tokenize2.js');
      $superselect_js_path = '/' . $superselect_js_path;
      $superselect_js = $minified
        ? $superselect_js_path . '/tokenize2.js'
        : $superselect_js_path . '/tokenize2.js';
      $libraries['superselect']['js'][$superselect_js] = [
        'minified' => $minified,
      ];
      $superselect_css = $superselect_js_path . '/tokenize2.css';
      $libraries['superselect.css']['css']['component'][$superselect_css] = [];
    }
  }
}

/**
 * Get the location of the chosen library.
 *
 * @return string
 *   The location of the library, or FALSE if the library isn't installed.
 */
function _superselect_lib_get_path() {
  if (function_exists('libraries_get_path')) {
    return libraries_get_path('superselect');
  }

  // The following logic is taken from libraries_get_libraries()
  $searchdir = [];

  // Similar to 'modules' and 'themes' directories inside an installation
  // profile, installation profiles may want to place libraries into a
  // 'libraries' directory.
  $searchdir[] = 'profiles/' . drupal_get_profile() . '/libraries';

  // Always search libraries.
  $searchdir[] = 'libraries';

  // Also search sites/<domain>/*.
  $searchdir[] = \Drupal::service('site.path') . '/libraries';

  foreach ($searchdir as $dir) {
    if (file_exists($dir . '/superselect/tokenize2.js') || file_exists($dir . '/superselect/tokenize2.js')) {
      return $dir . '/superselect';
    }
  }

  return FALSE;
}
