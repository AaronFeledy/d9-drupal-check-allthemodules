<?php

/**
 * @file
 * Module file for the drush_progress module.
 *
 * Code inspired by https://gist.github.com/pounard/3c1679e32eca87ecf7cf.
 */

use Drupal\drush_progress\Drush\ProgressBar;

/**
 * Retrieves a ProgressBar instance.
 *
 * Since there are almost no use cases where you would want two instances of
 * a progress bar active at the same time, this will create one _only if an
 * instance doesn't exist already_. If a progress bar has already been
 * instantiated, this will return the active progress bar instance.
 *
 * Usage as follow:
 * @code
 *   $total = 1000;
 *   $bar = drush_progress_bar();
 *   for ($i = 0; $i < $total; ++$i) {
 *     do_something_with($i);
 *     $bar->update($i / $total);
 *     // Or alternatively you could use:
 *     $bar->setProgress($total, $i);
 *   }
 *   $bar->end();
 * @endcode
 *
 * @return Drupal\drush_progress\Drush\ProgressBar
 *   A progress bar instance.
 */
function drush_progress_bar() {
  static $progress_bar = NULL;

  if ($progress_bar && $progress_bar->inProgress) {
    return $progress_bar;
  }
  else {
    $progress_bar = new ProgressBar();
    return $progress_bar;
  }
}
