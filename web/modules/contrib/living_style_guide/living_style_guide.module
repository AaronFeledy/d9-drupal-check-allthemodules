<?php

/**
 * @file
 * Takes care of some general tasks for the living style guide.
 */

/**
 * Implements hook_theme().
 */
function living_style_guide_theme($existing, $type, $theme, $path) {
  return [
    'style_guide' => [],
  ];
}

/**
 * Implements hook_preprocess_HOOK().
 */
function living_style_guide_preprocess_image(&$variables) {
  if (!is_on_living_styleguide_route()) {
    return;
  }

  $imageSource = explode('/http', $variables['attributes']['src'])[1];
  $protocol = $imageSource[0] === 's' ? 'https://' : 'http://';
  $imageSource = explode('/', $imageSource, 2)[1];

  $variables['attributes']['src'] = $protocol . $imageSource;
}

/**
 * Checks if the current route is part of the living style guide.
 *
 * @return bool
 *   True if the current route matches the living style guide.
 */
function is_on_living_styleguide_route() {
  $currentRoute = \Drupal::routeMatch();
  $routeName = $currentRoute->getRouteName();
  return substr($routeName, 0, 19) === 'living_style_guide.';
}
