<?php

/**
 * Implements hook_commerce_payment_method_info().
 */
function commerce_cmcic_commerce_payment_method_info() {
  $payment_methods = array();

  $display_title = theme('cmcic_icons_title');
  $icons = theme('cmcic_icons_payment');
  $display_title .= '<div class="commerce-cmcic-icons"><span class="label">' . t('Includes:') . '</span>' . implode(' ', $icons) . '</div>';

  $payment_methods['commerce_cmcic'] = array(
    'base' => 'commerce_cmcic',
    'title' => t('Credit Mutuel - CIC'),
    'short_title' => t('CM-CIC'),
    'display_title' => $display_title,
    'description' => t('CM-CIC Payments'),
    'terminal' => FALSE,
    'offsite' => TRUE,
    'offsite_autoredirect' => TRUE,
  );

  return $payment_methods;
}

/**
 * Payment method callback: adds a message and CSS to the submission form.
 */
function commerce_cmcic_submit_form($payment_method, $pane_values, $checkout_pane, $order) {
  $form['commerce_cmcic_information'] = array(
    '#markup' => '<span class="commerce-commerce-cmcic-info">' . t('(Continue with checkout to complete payment via CM-CIC.)') . '</span>',
  );

  return $form;
}

/**
 * Implements hook_theme().
 */
function commerce_cmcic_theme() {
  return array(
    'cmcic_icons_title' => array(
      'variables' => array(),
    ),
    'cmcic_icons_payment' => array(
      'variables' => array(),
    ),
  );
}

/**
 * Theme function for "cmcic_icons_title".
 *
 * @param array $variables
 *   Store data parameters.
 *
 * @return string
 *   The output of this theme.
 */
function theme_cmcic_icons_title(&$variables) {
  $icon_variables = array(
    'path' => drupal_get_path('module', 'commerce_cmcic') . '/kit/images/logocmcicpaiement.png',
    'title' => t('CM-CIC Payment'),
    'alt' => t('CM-CIC Payment'),
    'attributes' => array(
      'class' => array('commerce-cmcic-icon'),
    ),
  );
  $icon = theme('image', $icon_variables);
  $display_title = t('!logo <b>Credit card Payment</b>', array('!logo' => $icon));
  return $display_title;
}

/**
 * Theme function for "cmcic_icons_payment".
 *
 * @param array $variables
 *   Store data parameters.
 *
 * @return string
 *   The output of this theme.
 */
function theme_cmcic_icons_payment(&$variables) {
  $icons = array();

  $payment_methods = array(
    'visa' => t('Visa'),
    'mastercard' => t('Mastercard'),
    'amex' => t('American Express'),
    'cb' => t('CB'),
  );

  foreach ($payment_methods as $name => $title) {
    $variables = array(
      'path' => drupal_get_path('module', 'commerce_cmcic') . '/kit/images/' . $name . '.gif',
      'title' => $title,
      'alt' => $title,
      'attributes' => array(
        'class' => array('commerce-cmcic-icon'),
      ),
    );
    $icons[$name] = theme('image', $variables);
  }

  return $icons;
}
