<?php

/**
 * @file
 * Batch video module.
 */

/**
 *  Implements hook_theme_registry_alter().
 */
function bideo_theme_registry_alter(&$theme_registry) {
  $theme_registry['progress_bar']['preprocess'][] = 'bideo_preprocess_progress_bar';
  $theme_registry['progress_bar']['path'] = \Drupal::moduleHandler()->getModule('bideo')->getPath() . '/templates/';
  $theme_registry['progress_bar']['template'] = 'progress-bar';
}

/**
 * Implements hook_preprocess_progress_bar().
 */
function bideo_preprocess_progress_bar(&$variables) {
  // Get a video.
  $bideo = bideo_get_video();
  if ($bideo) {
    $variables['video'] = $bideo->render();
  }
}

/**
 * Returns a random Batch video configuration entity.
 *
 * @return \Drupal\bideo\Entity\Bideo
 *  The batch video configuration entity.
 */
function bideo_get_video() {
  $bideos = \Drupal::entityManager()->getStorage('bideo')->loadMultiple();
  $id = array_rand($bideos);
  return $bideos[$id];
}
