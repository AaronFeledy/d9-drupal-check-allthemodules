<?php

/**
 * @file
 * CKEditor Standalone Styles module.
 */

use Drupal\ckeditor_standalone_styles\Form\CkeditorStandaloneStylesSettingsForm;

/**
 * Implements hook_filter_info_alter().
 */
function ckeditor_standalone_styles_filter_info_alter(array &$filters) {
  // Swap out the class used for core's "filter_html" text filter with our own
  // so we can dynamically feed it additional HTML to allow.
  if (isset($filters['filter_html'])) {
    $filters['filter_html']['class'] = '\Drupal\ckeditor_standalone_styles\Plugin\Filter\FilterHtmlCustom';
  }
}

/**
 * Implements hook_editor_js_settings_alter().
 */
function ckeditor_standalone_styles_editor_js_settings_alter(array &$settings) {
  foreach ($settings['editor']['formats'] as $formatId => &$config) {
    // Only add styles if editor format is already configured with the styles
    // plugin.
    if (isset($config['editorSettings']['stylesSet'])) {
      $rawStyles = \Drupal::config('ckeditor_standalone_styles.settings')->get('styles');
      $parsedStyles = CkeditorStandaloneStylesSettingsForm::generateStylesSetSetting($rawStyles);
      if ($parsedStyles && !empty($parsedStyles)) {
        $config['editorSettings']['stylesSet'] = $parsedStyles;
      }
    }
  }
}
