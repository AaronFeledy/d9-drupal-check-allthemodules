<?php
/**
 * @file
 * Show Database Name module for Drupal 8.
 */

use Drupal\Core\Database\Database;
use Drupal\Core\Url;

/**
 * Implements hook_toolbar().
 */
function show_database_name_toolbar() {
  if (\Drupal::currentUser()->hasPermission('access database information')) {
    $url = (\Drupal::currentUser()->hasPermission('administer site configuration')) ? Url::fromRoute('system.status') : Url::fromRoute('<front>');
    $db_details = get_database_details();
    $items['primary_tasks'] = array(
      '#type' => 'toolbar_item',
      'tab' => array(
        '#type' => 'link',
        '#title' => $db_details,
        '#url' => $url,
        '#attributes' => array(
          'title' => t('Database Details'),
        ),
      ),
      '#cache' => array(
        'contexts' => array('user.permissions', 'url.path'),
      ),
      '#weight' => 1000,
    );
    return $items;
  }
}

function get_database_details() {
  $database_details = Database::getConnectionInfo('default');
  return t('Host: @host | DB: @db_name', array('@host' => $database_details['default']['host'],'@db_name' => $database_details['default']['database']));
}