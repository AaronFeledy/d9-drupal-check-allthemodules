<?php

/**
 * @file
 * Primary module hooks for bodyclass_403_404 module.
 *
 * @DCG
 * This file is no longer required in Drupal 8.
 * @see https://www.drupal.org/node/2217931
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function bodyclass_403_404_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for Bodyclass_403_404 module.
    case 'help.page.bodyclass_403_404':
      $output = '';
      $output .= '<h3>' . t('About Bodyclass 403 404') . '</h3>';
      $output .= '<p>' . t('Provides a custom class for body in 403, 404 and a list of pages.') . '</p>';
      $output .= '<p>' . t('Just add a class to the element and il will appear in your browser.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_preprocess_HOOK() for HTML document templates.
 *
 * Adds body classes if certain regions have content.
 */
function bodyclass_403_404_preprocess_html(&$variables) {

  // We get the current uri, to compare later with our defined pages.
  $current_uri = \Drupal::request()->getRequestUri();

  // We get our defined pages in configuration.
  // We receive a text and we transform it into an array.
  // in order to search into it.
  $pages = array_map("trim", explode("\n", \Drupal::configFactory()->getEditable('bodyclass_403_404.settings')->get('pages')));

  // We get our defined config.
  $body_403 = \Drupal::configFactory()->getEditable('bodyclass_403_404.settings')->get('body_403');
  $body_404 = \Drupal::configFactory()->getEditable('bodyclass_403_404.settings')->get('body_404');
  $custom_body = \Drupal::configFactory()->getEditable('bodyclass_403_404.settings')->get('custom_body');

  // We check in current request is an exception to check which error is.
  $status = \Drupal::requestStack()->getCurrentRequest()->attributes->get('exception');

  // Check different conditions to add body classes.
  if ($status && $status->getStatusCode() == 404) {
    $variables['attributes']['class'][] .= $body_404;
  }
  if ($status && $status->getStatusCode() == 403) {
    $variables['attributes']['class'][] .= $body_403;
  }
  if (in_array($current_uri, $pages)) {
    $variables['attributes']['class'][] .= $custom_body;
  }
}
