<?php

function menu_custom_access_menu_access(\Drupal\Core\Entity\EntityInterface $entity, $operation, \Drupal\Core\Session\AccountInterface $account) {
	//get the config
  $config = \Drupal::config('menu_custom_access.settings');
  $menus = $config->get('menu_custom_access.menus');
  //loop through the menus so we can use it later
  $set_menu_options = [];
  foreach ($menus as $k => $v) {
 	 if(!empty($v)) {
 	 	$set_menu_options[] = $v;
 	 }
  }

  //restrict access to the menus we set in config
  $is_admin_user = \Drupal\user\Entity\User::load(\Drupal::currentUser()->id())->hasRole('administrator');

  if(in_array($entity->id(), $set_menu_options) 
    && (in_array($operation, array('update', 'delete')))) {

    //If admin user, allow menu access
    if($is_admin_user) return \Drupal\Core\Access\AccessResult::neutral();

    //check to make sure the we are giving access to the correct account
    $account_does_not_have_role = array_diff($account->getRoles(TRUE), $config->get('menu_custom_access.roles'));
    if(!empty($account_does_not_have_role)) {
			return \Drupal\Core\Access\AccessResult::forbidden();
		}
	}
	return \Drupal\Core\Access\AccessResult::neutral();


}