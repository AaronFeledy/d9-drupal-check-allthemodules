<?php

/**
 * Implements hok_filter_functions().
 */
function function_filter_filter_functions() {
  return [
    'current_date' => [
      'function' => 'function_filter__current_date',
      'file' => __DIR__ . '/function_filter.functions.inc',
      'cache' => FALSE,
    ],
    'contact_form' => [
      'function' => 'function_filter__contact_form',
      'file' => __DIR__ . '/function_filter.functions.inc',
      'cache' => FALSE,
    ],
  ];
}

/**
 * Return filter functions.
 */
function function_filter_get_functions() {
  $functions = &drupal_static(__FUNCTION__);

  if ($functions === NULL) {
    $functions = \Drupal::moduleHandler()->invokeAll('filter_functions');
  }

  return $functions;
}

/**
 * Return function info.
 */
function function_filter_get_function_info_by_token_param($token_param) {
  $token_params = explode(':', $token_param, 2);
  $function_name = str_replace('-', '_', $token_params[0]);
  $function_name = preg_replace('/[^a-z0-9_]/', '', $function_name);
  $functions = function_filter_get_functions();

  if (isset($functions[$function_name])) {
    $function_arguments = isset($token_params[1]) ? explode(',', $token_params[1]) : [];
    return $functions[$function_name] + ['arguments' => $function_arguments];
  }

  return NULL;
}
