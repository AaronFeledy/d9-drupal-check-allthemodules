<?php
/**
 * @file
 * The token headers module file which implements the token for http headers.
 */
/**
 * Implements hook_token_info()
 */
function token_headers_token_info() {
  return ([
    'tokens' => [
      'site' => [
        'header' => [
          'name' => t("Header"),
          'description' => t('Provides a Token to pull from any HTTP header value'),
          'dynamic' => TRUE,
        ]
      ]
    ]
  ]);
}

/**
 * Implements hook_tokens()
 */
function token_headers_tokens($type, $tokens, array $data, array $options, \Drupal\Core\Render\BubbleableMetadata $bubbleable_metadata) {
  $request = \Drupal::request();
  $header_tokens = \Drupal::token()->findWithPrefix($tokens, 'header');
  $replacements = [];
  foreach ($header_tokens as $name => $original) {
    $replacements[$original] = $request->server->get($name);
  }
  return $replacements;
}