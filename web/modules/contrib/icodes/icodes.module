<?php
/**
 * @file
 * Ultimate Cron. Extend cron functionality in Drupal.
 */

// Default cron-function, configurable through /admin/config/system/cron
function icodes_cron() {
}

/*
 *
 */
function icodes_merchants_cron() {
  $data = \Drupal::service('icodes.process_merchants')->processFeed();

  $found = $data['icodes_merchant_feed_table'][0]['feed_merchants']['#markup'];
  $added = $data['icodes_merchant_feed_table'][0]['new_merchants']['#markup'];
  $message = $data['icodes_merchant_feed_table'][0]['message']['#markup'];

  \Drupal::logger('ultimate_cron_lock')->info('Found: @found Merchants and added @added. Message: @message', ['@found' => $found, '@added' => $added, '@message' => $message]);
}

function icodes_offers_cron() {
  $data = \Drupal::service('icodes.process_offers')->processFeed();

  $found = $data['icodes_offer_feed_table'][0]['feed_offers']['#markup'];
  $added = $data['icodes_offer_feed_table'][0]['new_offers']['#markup'];
  $message = $data['icodes_offer_feed_table'][0]['message']['#markup'];

  \Drupal::logger('ultimate_cron_lock')->info('Found: @found Offers and added @added. Message: @message', ['@found' => $found, '@added' => $added, '@message' => $message]);
}

/*
 *
 */
function icodes_vouchers_cron() {
  $data = \Drupal::service('icodes.process_vouchers')->processFeed();

  $found = $data['icodes_voucher_feed_table'][0]['feed_vouchers']['#markup'];
  $added = $data['icodes_voucher_feed_table'][0]['new_vouchers']['#markup'];
  $message = $data['icodes_voucher_feed_table'][0]['message']['#markup'];

  \Drupal::logger('ultimate_cron_lock')->info('Found: @found Vouchers and added @added. Message: @message', ['@found' => $found, '@added' => $added, '@message' => $message]);
}


/*
 *
 */
function icodes_cleanup_cron() {
  $data = \Drupal::service('icodes.process_cleanup')->processCleanup();

  $expired_count = $data['icodes_cleanup_table'][0]['expired_count']['#markup'];
  $active_count = $data['icodes_cleanup_table'][0]['active_count']['#markup'];

  \Drupal::logger('ultimate_cron_lock')->info('Expired Vouchers Removed: @expired. Active Vouchers Removed: $expired_count.', [ '@expired' => $expired_count, '@active_count' => $active_count]);
}

