# modules/custom/merci/modules/merci_migration/migrations/merci_resource.yml
id: merci_line_item
label: Merci Line Item
migration_group: Merci
migration_tags:
  - Custom

source:
  plugin: merci_line_item

process:
  id: tnid
  langcode:
    plugin: default_value
    source: language
    default_value: en
  name: title
  user_id:
    -
      plugin: get
      source: node_uid
    -
      plugin: default_value
      default_value: 1

  field_reserved_for/target_id:
    -
      plugin: get
      source: node_uid
    -
      plugin: default_value
      default_value: 1

  field_checkout/value:
    -
      plugin: extract
      source: field_merci_date
      default: '2017-12-09 10:00:00'
      index:
        - '0'
        - value
    -
      plugin: format_date
      from_format: 'Y-m-d H:i:s'
      to_format: 'Y-m-d\TH:i:s'
      timezone: 'GMT'

  field_checkin/value:
    -
      plugin: extract
      source: field_merci_date
      default: '2017-12-09 10:00:00'
      index:
        - '0'
        - value2
    -
      plugin: format_date
      from_format: 'Y-m-d H:i:s'
      to_format: 'Y-m-d\TH:i:s'
      timezone: 'GMT'

  merci_reservation_date/value:
    -
      plugin: extract
      source: field_merci_date
      default: '2017-12-09 10:00:00'
      index:
        - '0'
        - value
    -
      plugin: format_date
      from_format: 'Y-m-d H:i:s'
      to_format: 'Y-m-d\TH:i:s'
      timezone: 'GMT'

  merci_reservation_date/end_value:
    -
      plugin: extract
      source: field_merci_date
      default: '2017-12-09 10:00:00'
      index:
        - '0'
        - value2
    -
      plugin: format_date
      from_format: 'Y-m-d H:i:s'
      to_format: 'Y-m-d\TH:i:s'
      timezone: 'GMT'

  'merci_reservation_items/target_id':
      plugin: migration_lookup
      migration:
        - merci_resource
      source: merci_item_nid

  'field_merci_bucket_item/target_id':
      plugin: migration_lookup
      migration: merci_bucket
      no_stub: true
      source: type

  field_reservation_status:
   plugin: static_map
   source: merci_reservation_status
   default_value: checked_in
   map:
      1: unconfirmed
      2: pending
      3: checked_out
      4: checked_in
      5: canceled
      6: denied
      7: no_show

destination:
  plugin: 'entity:merci_line_item'
  default_bundle: merci_reservation
  migration_dependencies:
    required:
      - merci_resource
