# modules/custom/merci/modules/merci_migration/migrations/merci_bucket.yml
id: merci_bucket
label: Merci Bucket
migration_group: Merci
migration_tags:
  - Custom

source:
  plugin: merci_bucket

process:
  langcode:
    plugin: default_value
    source: language
    default_value: en
  title: name
  uid:
    -
      plugin: get
      source: node_uid
    -
      plugin: default_value
      default_value: 1
  created: created
  changed: changed
  'body/value': description
  'body/format': 
    plugin: default_value
    default_value: full_html
  'field_item':
    plugin: iterator
    source: bucket_items
    process:
      target_id:
        plugin: migration_lookup
        migration: merci_resource
        source: nid
  'field_merci_grouping/target_id':
    plugin: migration_lookup
    migration: merci_permissions
    source: type
  field_reservable_status:
    plugin: static_map
    source: merci_active_status
    map:
      1: 1
      2: 0
      3: 0
      4: 0

destination:
  plugin: 'entity:node'
  default_bundle: merci_bucket
  migration_dependencies:
    required:
      - merci_resource
      - merci_permissions
