
// data to save in the db table
street_number
route
sublocality_level_2
sublocality_level_1
locality,political
administrative_area_level_2
administrative_area_level_1
country,political
postal_code


// lat and long
if (navigator.geolocation) {
  var timeoutVal = 10 * 1000 * 1000;
  navigator.geolocation.getCurrentPosition(
    displayPosition,
    displayError,
    { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
  );
}
else {
  alert("Geolocation is not supported by this browser");
}

function displayPosition(position) {
  alert("Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude);
}
function displayError(error) {
  var errors = {
    1: 'Permission denied',
    2: 'Position unavailable',
    3: 'Request timeout'
  };
  alert("Error: " + errors[error.code]);
}


/// city name addresss
    jQuery(document).ready(function(){
        function displayLocation(latitude,longitude){
        var request = new XMLHttpRequest();

       var method = 'GET';
       var url = 'http://maps.googleapis.com/maps/api/geocode/json?latlng='+latitude+','+longitude+'&sensor=true';
       var async = true;

       request.open(method, url, async);
       request.onreadystatechange = function(){
       if(request.readyState == 4 && request.status == 200){
         var data = JSON.parse(request.responseText);
         alert(request.responseText); // check under which type your city is stored, later comment this line
         var addressComponents = data.results[0].address_components;
         for(i=0;i<addressComponents.length;i++){
            var types = addressComponents[i].types
            //alert(types);
            if(types=="locality,political"){
               alert(addressComponents[i].long_name); // this should be your city, depending on where you are
             }
           }
        //alert(address.city.short_name);
       }
    };
   request.send();
 };

 var successCallback = function(position){
 var x = position.coords.latitude;
 var y = position.coords.longitude;
 displayLocation(x,y);
  };


 navigator.geolocation.getCurrentPosition(successCallback);

  });


////////// save user data
function link_click_count_callback() {
  db_insert('link_click_count')->fields(array(
    'url' => $_GET["url"],
    'nid' => $_GET["nid"],
    'uid' => $GLOBALS['user']->uid,
    'date' => time(),
  ))->execute();
  $page_redirect = '';
  $pos = strpos($_GET["url"], "http://");
  $pos_ = strpos($_GET["url"], "https://");
  if ($pos === FALSE || $pos_ === FALSE) {
    $page_redirect = "http://" . $_GET["url"];
  }
  else {
    $page_redirect = $_GET["url"];
  }
  drupal_goto($page_redirect);
}
